root@ubuntu:/var/www/4vape# cd /var/www/4vape

# rebuild frontend
npm install
npm run build

# verifica che il bundle nuovo contenga la patch
grep -R "Conferma completamento" dist/assets || echo "PATCH NON NEL DIST"
grep -R "order-kebab" dist/assets || echo "kebab non presente nel bundle (ok)"

# backend (già che ci siamo)
cd /var/www/4vape/backend
npm install
npm run build
systemctl restart 4vape-api

up to date, audited 163 packages in 1s

33 packages are looking for funding
  run `npm fund` for details

5 moderate severity vulnerabilities

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.

> 4vape-buono@0.0.0 build
> vite build

vite v7.3.1 building client environment for production...
✓ 70 modules transformed.
node_modules/lottie-web/build/player/lottie.js (14422:32): Use of eval in "node_modules/lottie-web/build/player/lottie.js" is strongly discouraged as it poses security risks and may cause issues with minification.
dist/index.html                       0.46 kB │ gzip:   0.29 kB
dist/assets/map-D6pvesI8.svg         21.77 kB │ gzip:   8.37 kB
dist/assets/sale-L37BBs0d.mp3        56.16 kB
dist/assets/general-D4Q8dHm5.mp3     98.64 kB
dist/assets/logo-Di45eI5g.png     2,205.15 kB
dist/assets/index-CC7q4qTa.css       54.59 kB │ gzip:  11.74 kB
dist/assets/index-CtMn-GGE.js       950.95 kB │ gzip: 223.38 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 2.95s
dist/assets/index-CtMn-GGE.js:}`},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[45.137,45.137],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"st",c:{a:0,k:[.06274509803921569,.023529411764705882,.6235294117647059,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:8,ix:5},lc:1,lj:1,ml:4,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[.06274509803921569,.023529411764705882,.6235294117647059,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[-167.432,-17.432],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:30.0000012219251,st:0,bm:0}],markers$1=[],loadingAnim={v:v$1,fr:fr$1,ip:ip$1,op:op$1,w:w$1,h:h$1,nm:nm$1,ddd:ddd$1,assets:assets$1,layers:layers$1,markers:markers$1},v="5.7.6",fr=60,ip=135,op=179,w=375,h=471,nm="1.0.5 - User Entrance - Screen 5",ddd=0,assets=[],layers=[{ddd:0,ind:1,ty:4,nm:"1",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:0,s:[0]},{t:5,s:[100]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[188,236,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:0,s:[60,60,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:10,s:[120,120,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:20,s:[90,90,100]},{t:30,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[92.571,92.571],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"op",nm:"Offset Paths 1",a:{a:0,k:-.5,ix:1},lj:1,ml:{a:0,k:4,ix:3},ix:3,mn:"ADBE Vector Filter - Offset",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"1 Stroke",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[92.571,92.571],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"fl",c:{a:0,k:[.0196078431372549,1,.00784313725490196,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"1 Fill",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"5",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:30,s:[70]},{t:180,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[188,236,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},t:30,s:[55,55,100]},{t:180,s:[200,200,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"op",nm:"Offset Paths 1",a:{a:0,k:-.5,ix:1},lj:1,ml:{a:0,k:4,ix:3},ix:3,mn:"ADBE Vector Filter - Offset",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Stroke",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"fl",c:{a:0,k:[.0196078431372549,1,.00784313725490196,1],ix:4},o:{a:0,k:50.196,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Fill",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:30,op:300,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"6",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:75,s:[70]},{t:225,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[188,236,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},t:75,s:[55,55,100]},{t:225,s:[200,200,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"op",nm:"Offset Paths 1",a:{a:0,k:-.5,ix:1},lj:1,ml:{a:0,k:4,ix:3},ix:3,mn:"ADBE Vector Filter - Offset",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Stroke",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"fl",c:{a:0,k:[.0196078431372549,1,.00784313725490196,1],ix:4},o:{a:0,k:50.196,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Fill",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:75,op:345,st:45,bm:0},{ddd:0,ind:4,ty:4,nm:"7",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:120,s:[70]},{t:270,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[188,236,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},t:120,s:[55,55,100]},{t:270,s:[200,200,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"op",nm:"Offset Paths 1",a:{a:0,k:-.5,ix:1},lj:1,ml:{a:0,k:4,ix:3},ix:3,mn:"ADBE Vector Filter - Offset",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Stroke",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"fl",c:{a:0,k:[.0196078431372549,1,.00784313725490196,1],ix:4},o:{a:0,k:50.196,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Fill",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:120,op:390,st:90,bm:0},{ddd:0,ind:5,ty:4,nm:"2",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:165,s:[70]},{t:315,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[188,236,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},t:165,s:[55,55,100]},{t:315,s:[200,200,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"op",nm:"Offset Paths 1",a:{a:0,k:-.5,ix:1},lj:1,ml:{a:0,k:4,ix:3},ix:3,mn:"ADBE Vector Filter - Offset",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Stroke",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[154.286,154.286],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"fl",c:{a:0,k:[.0196078431372549,1,.00784313725490196,1],ix:4},o:{a:0,k:50.196,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"2 Fill",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:165,op:435,st:135,bm:0}],markers=[],pulseAnim={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers};function AdminSuppliers(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState(""),[o,c]=reactExports.useState({name:"",code:"",csvFullUrl:"",csvStockUrl:"",legalName:"",vatNumber:"",taxCode:"",sdiCode:"",pec:"",address:"",cap:"",city:"",province:"",country:"IT",phone:"",email:""}),[u,x]=reactExports.useState(null),[m,f]=reactExports.useState([]),[g,R]=reactExports.useState(0),[j,P]=reactExports.useState(1),S=20,[b,I]=reactExports.useState(null),[E,k]=reactExports.useState(""),[y,C]=reactExports.useState("all"),[M,B]=reactExports.useState(""),[G,U]=reactExports.useState(!1),[H,ht]=reactExports.useState(""),[dt,it]=reactExports.useState(""),[Et,vt]=reactExports.useState(!1),[lt,N]=reactExports.useState(""),[F,A]=reactExports.useState(!1),[O,q]=reactExports.useState(new Set),[D,$]=reactExports.useState([]),[Y,J]=reactExports.useState(""),[pt,bt]=reactExports.useState(""),[Ct,Tt]=reactExports.useState(""),[K,Dt]=reactExports.useState(""),[Lt,$t]=reactExports.useState(null),[zt,Rt]=reactExports.useState(""),ye=getToken(),he=L=>{if(!L)return L;let st=L;if(st.startsWith("/api/suppliers/")&&(st=st.replace("/api/suppliers/","/api/admin/suppliers/")),st.startsWith("/api/")&&ye){const At=st.includes("?")?"&":"?";return`${st}${At}token=${ye}`}return st},ce=Math.max(1,Math.ceil(g/S)),Xt=(()=>{const L=[],st=Yt=>L.push(Yt),At=()=>{L[L.length-1]!=="…"&&st("…")};st(1);const Bt=Math.max(2,j-1),W=Math.min(ce-1,j+1);Bt>2&&At();for(let Yt=Bt;Yt<=W;Yt+=1)st(Yt);return W<ce-1&&At(),ce>1&&st(ce),L})();reactExports.useEffect(()=>{const L=!!(b||G);return document.body.classList.toggle("modal-open",L),()=>document.body.classList.remove("modal-open")},[b,G]);async function pe(){try{const st=[...await api("/admin/suppliers")||[]].sort((At,Bt)=>new Date(Bt.createdAt).getTime()-new Date(At.createdAt).getTime());i(st)}catch{n("Impossibile caricare fornitori")}}reactExports.useEffect(()=>{pe()},[]),reactExports.useEffect(()=>{let L=!0;async function st(){try{const At=await api("/admin/categories");if(!L)return;$(At)}catch{}}return st(),()=>{L=!1}},[]);async function oe(L){L.preventDefault(),n("");try{await api("/admin/suppliers",{method:"POST",body:JSON.stringify({name:o.name,code:o.code,csvFullUrl:o.csvFullUrl||void 0,csvStockUrl:o.csvStockUrl||void 0,legalName:o.legalName||void 0,vatNumber:o.vatNumber||void 0,taxCode:o.taxCode||void 0,sdiCode:o.sdiCode||void 0,pec:o.pec||void 0,address:o.address||void 0,cap:o.cap||void 0,city:o.city||void 0,province:o.province||void 0,country:o.country||void 0,phone:o.phone||void 0,email:o.email||void 0})}),c({name:"",code:"",csvFullUrl:"",csvStockUrl:"",legalName:"",vatNumber:"",taxCode:"",sdiCode:"",pec:"",address:"",cap:"",city:"",province:"",country:"IT",phone:"",email:""}),pe()}catch{n("Errore creazione fornitore")}}async function se(L){try{vt(!0);const st=await api(`/admin/suppliers/${L}/import-full`,{method:"POST",body:JSON.stringify({})});ht("Inventario aggiornato"),it(`Creati ${st.created||0}, aggiornati ${st.updated||0}, saltati ${st.skipped||0}`),U(!0),setTimeout(()=>U(!1),2e3),u?.id===L&&de(u,1)}catch(st){const At=String(st?.message||""),Bt=At.startsWith("{")?(()=>{try{return JSON.parse(At)?.message}catch{return At}})():At;n(Bt||"Errore aggiornamento inventario")}finally{vt(!1)}}async function Kt(L){if(zt.trim())try{await api(`/admin/suppliers/${L}`,{method:"PATCH",body:JSON.stringify({name:zt.trim()})}),$t(null),Rt(""),pe()}catch{n("Errore rinomina fornitore")}}async function ue(L){if(window.confirm("Eliminare questo fornitore?"))try{await api(`/admin/suppliers/${L}`,{method:"DELETE"}),u?.id===L&&(x(null),f([])),await pe()}catch{n("Impossibile eliminare fornitore (controlla collegamenti prodotti)")}}async function Zt(L){if(u){Y||n("Import draft: nessuna categoria selezionata"),B("");try{const st={supplierSku:L.supplierSku,categoryId:Y||void 0,published:!1};lt&&(st.price=Number(lt));const At=await api(`/admin/suppliers/${u.id}/promote`,{method:"POST",body:JSON.stringify(st)});B(`Importato in store: created ${At.created}, già presenti ${At.already}`),ht("Importazione completata"),it("Prodotto inserito nello store"),I(null),U(!0),setTimeout(()=>U(!1),2e3),de(u,j)}catch{n("Errore import in store")}}}async function Ce(){if(!(!u||O.size===0)){pt||n("Import draft multiplo: nessuna categoria selezionata"),B("");try{const L=await api(`/admin/suppliers/${u.id}/promote`,{method:"POST",body:JSON.stringify({supplierSkus:Array.from(O),categoryId:pt||void 0,published:!1})});B(`${L.created} prodotti importati con successo`),ht("Importazione completata"),it(`${L.created} prodotti importati con successo`),U(!0),setTimeout(()=>U(!1),2e3),q(new Set),de(u,j)}catch{n("Errore import multiplo")}}}function ie(){if(!F)return;const L=m.filter(Bt=>!Bt.isImported).map(Bt=>Bt.supplierSku),st=L.length>0&&L.every(Bt=>O.has(Bt)),At=new Set(O);st?L.forEach(Bt=>At.delete(Bt)):L.forEach(Bt=>At.add(Bt)),q(At)}async function de(L,st=j,At=y){x(L),J(""),N("");try{const Bt=await api(`/admin/suppliers/${L.id}/products?page=${st}&perPage=${S}&q=${encodeURIComponent(E)}&importFilter=${encodeURIComponent(At)}`),W=[...Bt.items||[]].sort((Yt,Ft)=>{const me=new Date(Yt.createdAt||Yt.lastSeenAt||0).getTime();return new Date(Ft.createdAt||Ft.lastSeenAt||0).getTime()-me});f(W),R(Bt.total||0),P(Bt.page||st),q(new Set)}catch{n("Errore caricamento prodotti fornitore")}}const ke=(()=>{const L=new Map;for(const Bt of D){const W=L.get(Bt.parentId||"root")||[];W.push(Bt),L.set(Bt.parentId||"root",W)}const st=[],At=(Bt,W="")=>{const Yt=(L.get(Bt)||[]).sort((Ft,me)=>Ft.name.localeCompare(me.name));for(const Ft of Yt)st.push({...Ft,label:`${W}${Ft.name}`}),At(Ft.id,`${W}— `)};return At("root"),st})();async function Ue(){if(Ct.trim())try{const L=await api("/admin/categories",{method:"POST",body:JSON.stringify({name:Ct.trim(),parentId:K||void 0})});$(st=>[...st,L]),Tt(""),Dt(""),J(L.id),F&&bt(L.id)}catch{n("Errore creazione categoria")}}return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"page-header",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Drop"}),jsxRuntimeExports.jsx("p",{children:"Configura e importa prodotti dal drop"})]})}),jsxRuntimeExports.jsx(InlineError,{message:r,onClose:()=>n("")}),M?jsxRuntimeExports.jsx("div",{className:"panel",children:M}):null,G?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"success-center",children:jsxRuntimeExports.jsxs("div",{className:"success-card",children:[jsxRuntimeExports.jsx(Lottie,{animationData:successAnim,loop:!1}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:H||"Operazione completata"}),jsxRuntimeExports.jsx("div",{className:"muted",children:dt||"Operazione eseguita"})]})]})})}):null,Et?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsxs("div",{className:"loading-dock",children:[jsxRuntimeExports.jsx(Lottie,{animationData:loadingAnim,loop:!0}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Aggiornamento prodotti"}),jsxRuntimeExports.jsx("div",{className:"muted",children:"In corso…"})]})]})}):null,jsxRuntimeExports.jsxs("form",{className:"panel supplier-create-form",onSubmit:oe,children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Nuovo fornitore"}),jsxRuntimeExports.jsxs("div",{className:"order-form",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Nome"}),jsxRuntimeExports.jsx("input",{value:o.name,onChange:L=>c(st=>({...st,name:L.target.value})),required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Codice"}),jsxRuntimeExports.jsx("input",{value:o.code,onChange:L=>c(st=>({...st,code:L.target.value})),required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"CSV completo"}),jsxRuntimeExports.jsx("input",{value:o.csvFullUrl,onChange:L=>c(st=>({...st,csvFullUrl:L.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"CSV stock"}),jsxRuntimeExports.jsx("input",{value:o.csvStockUrl,onChange:L=>c(st=>({...st,csvStockUrl:L.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Ragione sociale"}),jsxRuntimeExports.jsx("input",{value:o.legalName,onChange:L=>c(st=>({...st,legalName:L.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"P.IVA"}),jsxRuntimeExports.jsx("input",{value:o.vatNumber,onChange:L=>c(st=>({...st,vatNumber:L.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"SDI"}),jsxRuntimeExports.jsx("input",{value:o.sdiCode,onChange:L=>c(st=>({...st,sdiCode:L.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"PEC"}),jsxRuntimeExports.jsx("input",{value:o.pec,onChange:L=>c(st=>({...st,pec:L.target.value}))})]})]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",type:"submit",children:"Crea fornitore"})})]}),jsxRuntimeExports.jsxs("div",{className:"table suppliers-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Codice"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),e.map(L=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:Lt===L.id?jsxRuntimeExports.jsxs("div",{className:"input-row",children:[jsxRuntimeExports.jsx("input",{value:zt,onChange:st=>Rt(st.target.value)}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>Kt(L.id),children:"Salva"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>{$t(null),Rt("")},children:"Annulla"})]}):jsxRuntimeExports.jsxs("div",{className:"input-row",children:[jsxRuntimeExports.jsx("strong",{children:L.name}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>{$t(L.id),Rt(L.name)},children:"Rinomina"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:()=>ue(L.id),children:"Elimina"})]})}),jsxRuntimeExports.jsx("div",{className:"mono",children:L.code}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>se(L.id),children:"Aggiorna inventario"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>de(L),children:"Vedi prodotti"})]})]},L.id))]}),u?jsxRuntimeExports.jsxs("div",{className:"panel",style:{marginTop:"1.5rem"},children:[jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{children:"Prodotti fornitore"}),jsxRuntimeExports.jsxs("p",{children:[u.name," — ",g," risultati"]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("input",{placeholder:"Cerca SKU o nome",value:E,onChange:L=>k(L.target.value),onKeyDown:L=>{L.key==="Enter"&&(L.preventDefault(),P(1),de(u,1))}}),jsxRuntimeExports.jsx("button",{className:"btn",onClick:()=>{P(1),de(u,1)},children:"Cerca"}),jsxRuntimeExports.jsxs("select",{className:"select",value:y,onChange:L=>{const st=L.target.value;C(st),P(1),de(u,1,st)},children:[jsxRuntimeExports.jsx("option",{value:"all",children:"Tutti"}),jsxRuntimeExports.jsx("option",{value:"imported",children:"Importato"}),jsxRuntimeExports.jsx("option",{value:"to-import",children:"Da importare"})]}),jsxRuntimeExports.jsx("button",{className:`btn ${F?"primary":"ghost"}`,onClick:()=>A(!F),children:F?"Selezione attiva":"Import multiplo"}),F?jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:ie,children:"Seleziona tutti in pagina"}):null,jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:Ce,disabled:!F||O.size===0,children:"Importa selezionati"}),F?jsxRuntimeExports.jsxs("select",{value:pt,onChange:L=>bt(L.target.value),className:"select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Categoria per import multiplo"}),ke.map(L=>jsxRuntimeExports.jsx("option",{value:L.id,children:L.label},L.id))]}):null]})]}),jsxRuntimeExports.jsxs("div",{className:"table wide-6",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Immagine"}),jsxRuntimeExports.jsx("div",{children:"SKU"}),jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Prezzo"}),jsxRuntimeExports.jsx("div",{children:"Giacenza"}),jsxRuntimeExports.jsx("div",{children:"Brand"})]}),m.map(L=>jsxRuntimeExports.jsxs("div",{className:"row clickable",onClick:()=>{if(F){if(L.isImported)return;const st=new Set(O);st.has(L.supplierSku)?st.delete(L.supplierSku):st.add(L.supplierSku),q(st);return}I(L)},children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"thumb-wrap",children:[L.isImported?jsxRuntimeExports.jsx(Lottie,{className:"pulse-dot",animationData:pulseAnim,loop:!0}):null,L.imageUrl?jsxRuntimeExports.jsx("img",{className:"thumb",src:he(L.imageUrl),alt:L.name||L.supplierSku,onClick:st=>{if(!F)return;st.stopPropagation();const At=new Set(O);At.has(L.supplierSku)?At.delete(L.supplierSku):At.add(L.supplierSku),q(At)}}):jsxRuntimeExports.jsx("div",{className:"thumb placeholder"})]})}),jsxRuntimeExports.jsx("div",{className:"mono",children:F?jsxRuntimeExports.jsxs("label",{className:`check ${L.isImported?"disabled":""}`,children:[jsxRuntimeExports.jsx("input",{type:"checkbox",disabled:L.isImported,checked:O.has(L.supplierSku),onChange:st=>{const At=new Set(O);st.target.checked?At.add(L.supplierSku):At.delete(L.supplierSku),q(At)}}),jsxRuntimeExports.jsx("span",{children:L.supplierSku})]}):L.supplierSku}),jsxRuntimeExports.jsx("div",{children:L.name||"-"}),jsxRuntimeExports.jsx("div",{children:L.price?`€ ${Number(L.price).toFixed(2)}`:"-"}),jsxRuntimeExports.jsx("div",{children:L.stockQty??"-"}),jsxRuntimeExports.jsx("div",{children:L.brand||"-"})]},L.id))]}),jsxRuntimeExports.jsxs("div",{className:"pagination",children:[jsxRuntimeExports.jsx("button",{className:"page-btn ghost",disabled:j<=1,onClick:()=>de(u,j-1),children:"Prev"}),Xt.map((L,st)=>L==="…"?jsxRuntimeExports.jsx("span",{className:"page-dots",children:"…"},`dots-${st}`):jsxRuntimeExports.jsx("button",{className:`page-btn ${L===j?"active":""}`,onClick:()=>de(u,L),children:L},L)),jsxRuntimeExports.jsx("button",{className:"page-btn ghost",disabled:j>=ce,onClick:()=>de(u,j+1),children:"Next"})]})]}):null,b?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>I(null),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{className:"modal-title",children:[jsxRuntimeExports.jsx("h3",{children:b.name||"Dettaglio prodotto"}),b.isImported?jsxRuntimeExports.jsx("span",{className:"tag success",children:"Già importato"}):null]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>I(null),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body",children:[jsxRuntimeExports.jsx("div",{className:"modal-media",children:b.imageUrl?jsxRuntimeExports.jsx("img",{src:he(b.imageUrl),alt:b.name||b.supplierSku}):jsxRuntimeExports.jsx("div",{className:"thumb placeholder large"})}),jsxRuntimeExports.jsxs("div",{className:"modal-info",children:[F?jsxRuntimeExports.jsxs("div",{className:"flag hero",children:[jsxRuntimeExports.jsx("span",{className:"flag-dot"}),"Imposta i dettagli"]}):null,jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"SKU:"})," ",b.supplierSku]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Prezzo:"})," ",b.price?`€ ${Number(b.price).toFixed(2)}`:"-"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Giacenza:"})," ",b.stockQty??"-"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Disponibilità:"})," ",b.stockQty&&b.stockQty>0?"Disponibile":"Out of stock"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Brand:"})," ",b.brand||"-"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Categoria:"})," ",b.category||"-"]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("strong",{children:"Descrizione:"})}),b.description?jsxRuntimeExports.jsx("div",{className:"rich-text muted",dangerouslySetInnerHTML:{__html:b.description}}):jsxRuntimeExports.jsx("div",{className:"muted",children:"-"}),jsxRuntimeExports.jsxs("div",{className:"form-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Categoria (obbligatoria)",jsxRuntimeExports.jsxs("select",{value:Y,onChange:L=>J(L.target.value),className:"select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleziona categoria"}),ke.map(L=>jsxRuntimeExports.jsx("option",{value:L.id,children:L.label},L.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"inline-create",children:[jsxRuntimeExports.jsx("input",{placeholder:"Nuova categoria",value:Ct,onChange:L=>Tt(L.target.value)}),jsxRuntimeExports.jsxs("select",{value:K,onChange:L=>Dt(L.target.value),className:"select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Sottocategoria di…"}),ke.map(L=>jsxRuntimeExports.jsx("option",{value:L.id,children:L.label},L.id))]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:Ue,children:"Crea"})]}),jsxRuntimeExports.jsxs("label",{children:["Prezzo vendita (€)",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",placeholder:b.price?Number(b.price).toFixed(2):"0.00",value:lt,onChange:L=>N(L.target.value)})]}),jsxRuntimeExports.jsx("div",{className:"muted",children:"Giacenza sincronizzata dal fornitore"})]}),jsxRuntimeExports.jsx("div",{children:F?jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>{const L=new Set(O);L.delete(b.supplierSku),q(L),I(null)},children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>{const L=new Set(O);L.add(b.supplierSku),q(L),I(null)},disabled:b.isImported,children:b.isImported?"Già importato":"Seleziona"})]}):jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>Zt(b),disabled:b.isImported,children:b.isImported?"Già importato":"Importa in store"})})]})]})]})})}):null]})}const emptyDiscount={name:"",code:"",active:!0,scope:"ORDER",target:"",type:"PERCENT",value:"",minSpend:"",startDate:"",endDate:"",notes:""},emptyRule={name:"",active:!0,scope:"ORDER",target:"",type:"PERCENT",value:"",maxDiscount:"",minQty:"",minSpend:"",stackable:!1,priority:50,startDate:"",endDate:"",days:[],timeFrom:"",timeTo:"",includeSkus:"",excludeSkus:"",notes:""},dayOptions=[{id:"mon",label:"Lun"},{id:"tue",label:"Mar"},{id:"wed",label:"Mer"},{id:"thu",label:"Gio"},{id:"fri",label:"Ven"},{id:"sat",label:"Sab"},{id:"sun",label:"Dom"}];function formatDiscount(e){const i=e.value?Number(e.value):0;return String(e.type).toUpperCase()==="PERCENT"?`${i.toFixed(2)}%`:`€ ${i.toFixed(2)}`}function buildSummary(e){const i=e.scope==="ORDER"?"Ordine":e.scope==="CATEGORY"?"Categoria":e.scope==="BRAND"?"Brand":e.scope==="SUPPLIER"?"Fornitore":"Prodotto",r=parseTargetList(e.target),n=r.length>1?`${r.length} selezionati`:r[0],o=n?` · ${n}`:"",c=e.minQty?`Min ${e.minQty} pezzi`:"",u=e.minSpend?`Min € ${Number(e.minSpend).toFixed(2)}`:"",x=[c,u].filter(Boolean).join(" | "),m=e.startDate||e.endDate?`${e.startDate||"—"} → ${e.endDate||"—"}`:"",f=e.timeFrom||e.timeTo?`${e.timeFrom||"—"}–${e.timeTo||"—"}`:"";return[`${i}${o}`,`Sconto ${formatDiscount(e)}`,x,m,f].filter(Boolean).join(" · ")}function parseTargetList(e){return e?e.split(",").map(i=>i.trim()).filter(Boolean):[]}function scopeLabel(e){switch(e){case"ORDER":return"Ordine";case"PRODUCT":return"Prodotti";case"CATEGORY":return"Categoria";case"BRAND":return"Brand";case"SUPPLIER":return"Fornitore";case"PARENT":return"Prodotti padre";default:return"—"}}function TargetPicker({scope:e,target:i,onChange:r,products:n,categories:o,loading:c,placeholder:u}){const[x,m]=reactExports.useState(""),f=reactExports.useMemo(()=>parseTargetList(i),[i]),g=e==="CATEGORY"?o:e==="PARENT"?n.filter(P=>P.isParent):n,R=reactExports.useMemo(()=>{if(!x.trim())return g.slice(0,200);const P=x.trim().toLowerCase();return g.filter(S=>e==="CATEGORY"?S.name?.toLowerCase().includes(P):`${S.sku} ${S.name}`.toLowerCase().includes(P)).slice(0,200)},[g,x,e]);function j(P){const S=new Set(f);S.has(P)?S.delete(P):S.add(P),r(Array.from(S).join(", "))}return e==="ORDER"?jsxRuntimeExports.jsx("div",{className:"muted",children:"Nessun target richiesto per l'intero ordine"}):e==="PRODUCT"||e==="CATEGORY"||e==="PARENT"?jsxRuntimeExports.jsxs("div",{className:"target-picker",children:[jsxRuntimeExports.jsx("input",{value:x,onChange:P=>m(P.target.value),placeholder:e==="CATEGORY"?"Cerca categoria":e==="PARENT"?"Cerca prodotto padre":"Cerca prodotto per SKU o nome"}),c?jsxRuntimeExports.jsx("div",{className:"muted",children:"Caricamento elenco..."}):null,jsxRuntimeExports.jsx("div",{className:"target-list",children:R.map(P=>{const S=e==="CATEGORY"||e==="PARENT"?P.id:P.sku,b=e==="CATEGORY"?P.name:e==="PARENT"?`${P.sku} · ${P.name}`:`${P.sku} · ${P.name}`,I=f.includes(S);return jsxRuntimeExports.jsxs("button",{type:"button",className:`target-row ${I?"active":""}`,onClick:()=>j(S),children:[jsxRuntimeExports.jsx("span",{className:`target-check ${I?"active":""}`,children:I?"✓":""}),jsxRuntimeExports.jsx("span",{children:b})]},S)})}),jsxRuntimeExports.jsx("div",{className:"target-meta",children:f.length?`${f.length} selezionati`:u})]}):jsxRuntimeExports.jsx("input",{value:i,onChange:P=>r(P.target.value),placeholder:u})}function AdminDiscountRules(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState([]),[o,c]=reactExports.useState(emptyRule),[u,x]=reactExports.useState(emptyDiscount),[m,f]=reactExports.useState(""),[g,R]=reactExports.useState(""),[j,P]=reactExports.useState(!1),[S,b]=reactExports.useState(!1),[I,E]=reactExports.useState(""),[k,y]=reactExports.useState(!1),[C,M]=reactExports.useState(!1),[B,G]=reactExports.useState(!1),[U,H]=reactExports.useState([]),[ht,dt]=reactExports.useState([]),[it,Et]=reactExports.useState(!1),[vt,lt]=reactExports.useState(!0),[N,F]=reactExports.useState(!0);reactExports.useEffect(()=>{let K=!0;async function Dt(){y(!0),E("");try{const[Lt,$t]=await Promise.all([api("/admin/rules"),api("/admin/discounts")]);if(!K)return;const zt=Rt=>({...Rt,type:Rt?.type?String(Rt.type).toUpperCase():Rt.type});i((Lt||[]).map(zt)),n(($t||[]).map(zt))}catch{E("Impossibile caricare sconti e regole")}finally{K&&y(!1)}}return Dt(),()=>{K=!1}},[]);async function A(){if(!(C||B)){G(!0);try{const[K,Dt]=await Promise.all([api("/admin/products"),api("/admin/categories")]);H(K||[]),dt(Dt||[]),M(!0)}catch{E("Impossibile caricare elenco prodotti/categorie")}finally{G(!1)}}}function O(K,Dt){(K==="PRODUCT"||K==="CATEGORY"||K==="PARENT")&&A(),Dt(K)}function q(){c(emptyRule),f("")}function D(){x(emptyDiscount),R("")}async function $(K){if(K.preventDefault(),!o.name.trim())return;if((o.scope==="PRODUCT"||o.scope==="CATEGORY"||o.scope==="PARENT")&&!o.target){E("Seleziona almeno un target per la regola.");return}const Dt=m||(crypto?.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`),Lt={...o,id:Dt,scope:o.scope||"ORDER",value:o.value?Number(o.value):0,maxDiscount:o.maxDiscount?Number(o.maxDiscount):0,minQty:o.minQty?Number(o.minQty):0,minSpend:o.minSpend?Number(o.minSpend):0,priority:Number(o.priority||0)};try{m?await api(`/admin/rules/${m}`,{method:"PATCH",body:JSON.stringify(Lt)}):await api("/admin/rules",{method:"POST",body:JSON.stringify(Lt)});const $t=await api("/admin/rules");i($t||[]),Et(!1),q(),b(!1)}catch{E("Errore salvataggio regola")}}function Y(K){f(K.id),b(!0),(K.scope==="PRODUCT"||K.scope==="CATEGORY")&&A(),c({...K,value:K.value?.toString()||"",maxDiscount:K.maxDiscount?.toString()||"",minQty:K.minQty?.toString()||"",minSpend:K.minSpend?.toString()||"",priority:K.priority??50})}async function J(K){if(confirm("Eliminare questa regola?"))try{await api(`/admin/rules/${K}`,{method:"DELETE"});const Dt=await api("/admin/rules");i(Dt||[]),m===K&&q()}catch{E("Errore eliminazione regola")}}async function pt(K){if(K.preventDefault(),!u.name.trim())return;if((u.scope==="PRODUCT"||u.scope==="CATEGORY"||u.scope==="PARENT")&&!u.target){E("Seleziona almeno un target per lo sconto.");return}const Dt=g||(crypto?.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`),Lt={...u,id:Dt,code:u.code?.trim()||void 0,scope:u.scope||"ORDER",value:u.value?Number(u.value):0,minSpend:u.minSpend?Number(u.minSpend):void 0};try{g?await api(`/admin/discounts/${g}`,{method:"PATCH",body:JSON.stringify(Lt)}):await api("/admin/discounts",{method:"POST",body:JSON.stringify(Lt)});const $t=await api("/admin/discounts");n($t||[]),D(),P(!1)}catch{E("Errore salvataggio sconto")}}function bt(K){R(K.id),P(!0),(K.scope==="PRODUCT"||K.scope==="CATEGORY")&&A(),x({...K,value:K.value?.toString()||"",minSpend:K.minSpend?.toString()||"",code:K.code||""})}async function Ct(K){if(confirm("Eliminare questo sconto?"))try{await api(`/admin/discounts/${K}`,{method:"DELETE"});const Dt=await api("/admin/discounts");n(Dt||[]),g===K&&D()}catch{E("Errore eliminazione sconto")}}const Tt=reactExports.useMemo(()=>buildSummary(o),[o]);return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"page-header",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Sconti e Regole"}),jsxRuntimeExports.jsx("p",{children:"Configura sconti in € o %, condizioni, priorità e periodi di validità"})]})}),jsxRuntimeExports.jsx(InlineError,{message:I,onClose:()=>E("")}),jsxRuntimeExports.jsxs("div",{className:"rules-layout",children:[jsxRuntimeExports.jsxs("div",{className:"rules-card",children:[jsxRuntimeExports.jsxs("div",{className:"rules-list",children:[jsxRuntimeExports.jsxs("div",{className:"rules-list-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{children:"Sconti attivi"}),jsxRuntimeExports.jsxs("div",{className:"muted",children:[r.length," sconti configurati"]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>lt(K=>!K),children:vt?"Nascondi":"Mostra"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>{D(),A(),P(!0)},children:"Crea nuovo sconto"})]})]}),vt?jsxRuntimeExports.jsxs("div",{className:"rules-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Ambito"}),jsxRuntimeExports.jsx("div",{children:"Valore"}),jsxRuntimeExports.jsx("div",{children:"Validità"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),r.map(K=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:K.name}),K.active?null:jsxRuntimeExports.jsx("span",{className:"tag warn",children:"Disattivo"})]}),jsxRuntimeExports.jsx("div",{children:scopeLabel(K.scope||"ORDER")}),jsxRuntimeExports.jsx("div",{children:formatDiscount(K)}),jsxRuntimeExports.jsxs("div",{children:[K.startDate||"—"," → ",K.endDate||"—"]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>bt(K),children:"Modifica"}),jsxRuntimeExports.jsx("button",{className:"btn danger small",onClick:()=>Ct(K.id),children:"Elimina"})]})]},K.id))]}):null]}),j?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>P(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:K=>K.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("h3",{children:g?"Modifica sconto":"Nuovo sconto"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>P(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body modal-body-single",children:jsxRuntimeExports.jsxs("form",{onSubmit:pt,className:"rules-form",children:[jsxRuntimeExports.jsxs("div",{className:"rules-header",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("div",{className:"muted",children:"Sconto semplice in € o %"})}),jsxRuntimeExports.jsxs("label",{className:"check",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:u.active,onChange:K=>x({...u,active:K.target.checked})}),jsxRuntimeExports.jsx("span",{children:"Attivo"})]})]}),jsxRuntimeExports.jsxs("div",{className:"rules-grid rules-grid-compact",children:[jsxRuntimeExports.jsxs("label",{className:"full",children:["Nome sconto",jsxRuntimeExports.jsx("input",{value:u.name,onChange:K=>x({...u,name:K.target.value}),placeholder:"Es. Sconto vetrina 5%"})]}),jsxRuntimeExports.jsxs("label",{children:["Codice sconto",jsxRuntimeExports.jsx("input",{value:u.code,onChange:K=>x({...u,code:K.target.value.toUpperCase()}),placeholder:"Es. WELCOME10"})]}),jsxRuntimeExports.jsxs("label",{children:["Ambito",jsxRuntimeExports.jsxs("select",{className:"select",value:u.scope,onChange:K=>O(K.target.value,Dt=>x({...u,scope:Dt})),children:[jsxRuntimeExports.jsx("option",{value:"ORDER",children:"Ordine"}),jsxRuntimeExports.jsx("option",{value:"PRODUCT",children:"Prodotti selezionati"}),jsxRuntimeExports.jsx("option",{value:"PARENT",children:"Prodotti padre"}),jsxRuntimeExports.jsx("option",{value:"CATEGORY",children:"Categoria"})]})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["Target",jsxRuntimeExports.jsx(TargetPicker,{scope:u.scope,target:u.target,onChange:K=>x({...u,target:K}),products:U,categories:ht,loading:B,placeholder:"Seleziona target"})]}),jsxRuntimeExports.jsxs("label",{children:["Tipo sconto",jsxRuntimeExports.jsxs("select",{className:"select",value:u.type,onChange:K=>x({...u,type:K.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"PERCENT",children:"Percentuale"}),jsxRuntimeExports.jsx("option",{value:"FIXED",children:"Valore fisso (€)"})]})]}),jsxRuntimeExports.jsxs("label",{children:["Valore",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:u.value,onChange:K=>x({...u,value:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Ordine minimo (€)",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:u.minSpend,onChange:K=>x({...u,minSpend:K.target.value}),placeholder:"0.00"})]}),jsxRuntimeExports.jsxs("label",{children:["Dal",jsxRuntimeExports.jsx("input",{type:"date",value:u.startDate,onChange:K=>x({...u,startDate:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Al",jsxRuntimeExports.jsx("input",{type:"date",value:u.endDate,onChange:K=>x({...u,endDate:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["Note interne",jsxRuntimeExports.jsx("textarea",{rows:3,value:u.notes,onChange:K=>x({...u,notes:K.target.value})})]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"btn ghost",onClick:D,children:"Reset"}),jsxRuntimeExports.jsx("button",{className:"btn primary",type:"submit",children:g?"Salva modifica":"Crea sconto"})]})]})})]})})}):null]}),jsxRuntimeExports.jsxs("div",{className:"rules-card",children:[jsxRuntimeExports.jsxs("div",{className:"rules-list",children:[jsxRuntimeExports.jsxs("div",{className:"rules-list-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{children:"Regole attive"}),jsxRuntimeExports.jsxs("div",{className:"muted",children:[e.length," regole configurate"]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>F(K=>!K),children:N?"Nascondi":"Mostra"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>{q(),A(),b(!0)},children:"Crea nuova regola"})]})]}),N?jsxRuntimeExports.jsxs("div",{className:"rules-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Ambito"}),jsxRuntimeExports.jsx("div",{children:"Sconto"}),jsxRuntimeExports.jsx("div",{children:"Validità"}),jsxRuntimeExports.jsx("div",{children:"Priorità"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),e.map(K=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:K.name}),K.active?null:jsxRuntimeExports.jsx("span",{className:"tag warn",children:"Disattiva"})]}),jsxRuntimeExports.jsx("div",{children:scopeLabel(K.scope)}),jsxRuntimeExports.jsx("div",{children:formatDiscount(K)}),jsxRuntimeExports.jsxs("div",{children:[K.startDate||"—"," → ",K.endDate||"—"]}),jsxRuntimeExports.jsx("div",{children:K.priority}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>Y(K),children:"Modifica"}),jsxRuntimeExports.jsx("button",{className:"btn danger small",onClick:()=>J(K.id),children:"Elimina"})]})]},K.id))]}):null]}),S?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>b(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:K=>K.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("h3",{children:m?"Modifica regola":"Nuova regola"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>b(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body modal-body-single",children:jsxRuntimeExports.jsxs("form",{onSubmit:$,className:"rules-form",children:[jsxRuntimeExports.jsxs("div",{className:"rules-header",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("div",{className:"muted",children:"Condizioni avanzate (qty, spesa, periodi)"})}),jsxRuntimeExports.jsxs("label",{className:"check",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:o.active,onChange:K=>c({...o,active:K.target.checked})}),jsxRuntimeExports.jsx("span",{children:"Attiva"})]})]}),jsxRuntimeExports.jsxs("div",{className:"rules-grid rules-grid-compact",children:[jsxRuntimeExports.jsxs("label",{className:"full",children:["Nome regola",jsxRuntimeExports.jsx("input",{value:o.name,onChange:K=>c({...o,name:K.target.value}),placeholder:"Es. Promo Vaporizzatori 10+"})]}),jsxRuntimeExports.jsxs("label",{children:["Ambito",jsxRuntimeExports.jsxs("select",{className:"select",value:o.scope,onChange:K=>O(K.target.value,Dt=>c({...o,scope:Dt})),children:[jsxRuntimeExports.jsx("option",{value:"ORDER",children:"Ordine"}),jsxRuntimeExports.jsx("option",{value:"PRODUCT",children:"Prodotti selezionati"}),jsxRuntimeExports.jsx("option",{value:"PARENT",children:"Prodotti padre"}),jsxRuntimeExports.jsx("option",{value:"CATEGORY",children:"Categoria"}),jsxRuntimeExports.jsx("option",{value:"BRAND",children:"Brand"}),jsxRuntimeExports.jsx("option",{value:"SUPPLIER",children:"Fornitore"})]})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["Target",jsxRuntimeExports.jsx(TargetPicker,{scope:o.scope,target:o.target,onChange:K=>c({...o,target:K}),products:U,categories:ht,loading:B,placeholder:"SKU, nome brand, categoria..."})]}),jsxRuntimeExports.jsxs("label",{children:["Tipo sconto",jsxRuntimeExports.jsxs("select",{className:"select",value:o.type,onChange:K=>c({...o,type:K.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"PERCENT",children:"Percentuale"}),jsxRuntimeExports.jsx("option",{value:"FIXED",children:"Valore fisso (€)"})]})]}),jsxRuntimeExports.jsxs("label",{children:["Valore",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:o.value,onChange:K=>c({...o,value:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Minimo pezzi",jsxRuntimeExports.jsx("input",{type:"number",value:o.minQty,onChange:K=>c({...o,minQty:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Minimo spesa (€)",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:o.minSpend,onChange:K=>c({...o,minSpend:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Priorità (0-100)",jsxRuntimeExports.jsx("input",{type:"number",value:o.priority,onChange:K=>c({...o,priority:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{className:"check",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:o.stackable,onChange:K=>c({...o,stackable:K.target.checked})}),jsxRuntimeExports.jsx("span",{children:"Compatibile con altri sconti"})]}),jsxRuntimeExports.jsxs("label",{children:["Dal",jsxRuntimeExports.jsx("input",{type:"date",value:o.startDate,onChange:K=>c({...o,startDate:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Al",jsxRuntimeExports.jsx("input",{type:"date",value:o.endDate,onChange:K=>c({...o,endDate:K.target.value})})]})]}),jsxRuntimeExports.jsx("button",{type:"button",className:"btn ghost small",onClick:()=>{it||A(),Et(K=>!K)},children:it?"Nascondi avanzate":"Mostra avanzate"}),it?jsxRuntimeExports.jsxs("div",{className:"rules-grid rules-advanced",children:[jsxRuntimeExports.jsxs("label",{children:["Sconto massimo (€)",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:o.maxDiscount,onChange:K=>c({...o,maxDiscount:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Orario da",jsxRuntimeExports.jsx("input",{type:"time",value:o.timeFrom,onChange:K=>c({...o,timeFrom:K.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Orario a",jsxRuntimeExports.jsx("input",{type:"time",value:o.timeTo,onChange:K=>c({...o,timeTo:K.target.value})})]}),jsxRuntimeExports.jsxs("div",{className:"full",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Giorni validità"}),jsxRuntimeExports.jsx("div",{className:"day-picker",children:dayOptions.map(K=>jsxRuntimeExports.jsx("button",{type:"button",className:`day-pill ${o.days.includes(K.id)?"active":""}`,onClick:()=>{const Dt=new Set(o.days);Dt.has(K.id)?Dt.delete(K.id):Dt.add(K.id),c({...o,days:Array.from(Dt)})},children:K.label},K.id))})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["SKU inclusi (separati da virgola)",jsxRuntimeExports.jsx("input",{value:o.includeSkus,onChange:K=>c({...o,includeSkus:K.target.value}),placeholder:"SKU1, SKU2, SKU3"})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["SKU esclusi (separati da virgola)",jsxRuntimeExports.jsx("input",{value:o.excludeSkus,onChange:K=>c({...o,excludeSkus:K.target.value}),placeholder:"SKU4, SKU5"})]}),jsxRuntimeExports.jsxs("label",{className:"full",children:["Note interne",jsxRuntimeExports.jsx("textarea",{rows:3,value:o.notes,onChange:K=>c({...o,notes:K.target.value})})]})]}):null,jsxRuntimeExports.jsxs("div",{className:"rules-preview",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Anteprima regola"}),jsxRuntimeExports.jsx("strong",{children:Tt||"Compila i campi per vedere l’anteprima"})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"btn ghost",onClick:q,children:"Reset"}),jsxRuntimeExports.jsx("button",{className:"btn primary",type:"submit",children:m?"Salva modifica":"Crea regola"})]})]})})]})})}):null]})]})]})}function AdminCategories(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState(""),[o,c]=reactExports.useState(""),[u,x]=reactExports.useState({name:"",description:"",parentId:""}),[m,f]=reactExports.useState(null);async function g(){try{const y=await api("/admin/categories");i(y||[])}catch{n("Impossibile caricare categorie")}}reactExports.useEffect(()=>{g()},[]);async function R(y){y.preventDefault(),n("");try{await api("/admin/categories",{method:"POST",body:JSON.stringify({name:u.name,description:u.description||void 0,parentId:u.parentId||void 0})}),x({name:"",description:"",parentId:""}),g()}catch{n("Errore creazione categoria")}}async function j(){if(m)try{await api(`/admin/categories/${m.id}`,{method:"PATCH",body:JSON.stringify({name:m.name,description:m.description||null,parentId:m.parentId||null})}),f(null),g()}catch{n("Errore modifica categoria")}}async function P(y){n("");try{await api(`/admin/categories/${y}`,{method:"DELETE"}),g()}catch{n("Impossibile eliminare: rimuovi prima le sottocategorie.")}}async function S(y,C){const M=k.map(ht=>ht.id),B=M.indexOf(y);if(B<0)return;const G=C==="up"?B-1:B+1;if(G<0||G>=M.length)return;const U=[...M],[H]=U.splice(B,1);U.splice(G,0,H);try{await api("/admin/categories/reorder",{method:"PATCH",body:JSON.stringify({ids:U})}),g()}catch{n("Impossibile riordinare categorie")}}const b=new Map;for(const y of e){const C=y.parentId||"root",M=b.get(C)||[];M.push(y),b.set(C,M)}const I=[],E=(y,C="")=>{const M=(b.get(y)||[]).sort((B,G)=>(B.sortOrder??0)-(G.sortOrder??0)||B.name.localeCompare(G.name));for(const B of M)I.push({...B,label:`${C}${B.name}`}),E(B.id,`${C}— `)};E("root");const k=reactExports.useMemo(()=>{const y=o.trim().toLowerCase();return y?I.filter(C=>`${C.name||""} ${C.description||""}`.toLowerCase().includes(y)):I},[o,e]);return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"page-header",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Categorie"}),jsxRuntimeExports.jsx("p",{children:"Gestione categorie e sottocategorie"})]})}),jsxRuntimeExports.jsx(InlineError,{message:r,onClose:()=>n("")}),jsxRuntimeExports.jsx("div",{className:"panel",children:jsxRuntimeExports.jsxs("form",{className:"form-grid",onSubmit:R,children:[jsxRuntimeExports.jsxs("label",{children:["Nome categoria",jsxRuntimeExports.jsx("input",{value:u.name,onChange:y=>x({...u,name:y.target.value}),required:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Descrizione",jsxRuntimeExports.jsx("input",{value:u.description,onChange:y=>x({...u,description:y.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Sottocategoria di",jsxRuntimeExports.jsxs("select",{value:u.parentId,onChange:y=>x({...u,parentId:y.target.value}),className:"select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Nessuna (categoria principale)"}),I.map(y=>jsxRuntimeExports.jsx("option",{value:y.id,children:y.label},y.id))]})]}),jsxRuntimeExports.jsxs("label",{children:["Cerca",jsxRuntimeExports.jsx("input",{value:o,onChange:y=>c(y.target.value),placeholder:"Nome o descrizione"})]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",type:"submit",children:"Crea categoria"})})]})}),jsxRuntimeExports.jsxs("div",{className:"table categories-rich-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Categoria"}),jsxRuntimeExports.jsx("div",{children:"Tipo"}),jsxRuntimeExports.jsx("div",{children:"Descrizione"}),jsxRuntimeExports.jsx("div",{children:"Prodotti"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),k.map(y=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:y.label}),jsxRuntimeExports.jsx("div",{className:"muted",children:y.parentId?"Sottocategoria":"Principale"}),jsxRuntimeExports.jsx("div",{children:y.description||"—"}),jsxRuntimeExports.jsx("div",{children:y._count?.products||0}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>f({...y}),children:"Modifica"}),jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>S(y.id,"up"),children:"↑"}),jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>S(y.id,"down"),children:"↓"}),jsxRuntimeExports.jsx("button",{className:"btn danger small",onClick:()=>P(y.id),children:"Elimina"})]})]},y.id))]}),m?jsxRuntimeExports.jsxs("div",{className:"panel",style:{marginTop:12},children:[jsxRuntimeExports.jsx("h3",{children:"Modifica categoria"}),jsxRuntimeExports.jsxs("div",{className:"form-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Nome",jsxRuntimeExports.jsx("input",{value:m.name,onChange:y=>f({...m,name:y.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Descrizione",jsxRuntimeExports.jsx("input",{value:m.description||"",onChange:y=>f({...m,description:y.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Parent",jsxRuntimeExports.jsxs("select",{className:"select",value:m.parentId||"",onChange:y=>f({...m,parentId:y.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Nessuno"}),I.filter(y=>y.id!==m.id).map(y=>jsxRuntimeExports.jsx("option",{value:y.id,children:y.label},y.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>f(null),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:j,children:"Salva"})]})]})]}):null]})}const STATUS_OPTIONS=[{value:"DRAFT",label:"Bozza"},{value:"SUBMITTED",label:"In attesa pagamento"},{value:"APPROVED",label:"Elaborazione"},{value:"FULFILLED",label:"Completato"},{value:"CANCELLED",label:"Fallito"}],PAYMENT_OPTIONS=[{value:"BANK_TRANSFER",label:"Bonifico"},{value:"CARD",label:"Carta"},{value:"COD",label:"Contrassegno"},{value:"OTHER",label:"Altro"}],STATUS_SORT_PRIORITY={FULFILLED:0,APPROVED:1,SUBMITTED:2,DRAFT:3,CANCELLED:4},formatCurrency=e=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(Number(e||0));function AdminOrders(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState([]),[o,c]=reactExports.useState(""),[u,x]=reactExports.useState("ALL"),[m,f]=reactExports.useState("ALL"),[g,R]=reactExports.useState(""),[j,P]=reactExports.useState("ALL"),[S,b]=reactExports.useState(""),[I,E]=reactExports.useState(""),[k,y]=reactExports.useState(!1),[C,M]=reactExports.useState(null),[B,G]=reactExports.useState(null),[U,H]=reactExports.useState(""),[ht,dt]=reactExports.useState("SUBMITTED"),[it,Et]=reactExports.useState(""),[vt,lt]=reactExports.useState([]),[N,F]=reactExports.useState([]),[A,O]=reactExports.useState([]),[q,D]=reactExports.useState("APPROVED"),[$,Y]=reactExports.useState([]),[J,pt]=reactExports.useState(!1),[bt,Ct]=reactExports.useState("BANK_TRANSFER"),[Tt,K]=reactExports.useState(""),[Dt,Lt]=reactExports.useState("SUBMITTED"),[$t,zt]=reactExports.useState("BANK_TRANSFER"),[Rt,ye]=reactExports.useState([]),[he,ce]=reactExports.useState(""),[Xt,pe]=reactExports.useState([]),[oe,se]=reactExports.useState(null);async function Kt(){try{const z=new URLSearchParams;u!=="ALL"&&z.set("status",u),m!=="ALL"&&z.set("paymentMethod",m),g&&z.set("companyId",g),j!=="ALL"&&z.set("groupName",j),S&&z.set("start",S),I&&z.set("end",I);const at=await api(`/admin/orders${z.toString()?`?${z.toString()}`:""}`);i(at),O([])}catch{c("Impossibile caricare ordini")}}async function ue(){try{const z=await api("/admin/orders/stats");Y(z||[])}catch{Y([])}}async function Zt(){try{const z=await api("/admin/companies");n(z),!U&&z.length&&H(z[0].id)}catch{c("Impossibile caricare aziende")}}reactExports.useEffect(()=>{Kt(),ue()},[u,m,g,j,S,I]),reactExports.useEffect(()=>{Zt()},[]),reactExports.useEffect(()=>{C&&(Zt(),K(C.companyId||""),Lt(C.status||"SUBMITTED"),zt(C.paymentMethod||"BANK_TRANSFER"),ye((C.items||[]).map(z=>({productId:z.productId,sku:z.sku,name:z.name,unitPrice:Number(z.unitPrice||0),qty:Number(z.qty||1),taxRate:Number(z.product?.taxRate||z.product?.taxRateRef?.rate||0),exciseTotal:z.product?.exciseTotal,exciseMl:z.product?.exciseMl,exciseProduct:z.product?.exciseProduct}))),ce(""),pe([]))},[C]),reactExports.useEffect(()=>{let z=!0;if(!it.trim()){lt([]);return}const at=setTimeout(async()=>{try{const mt=await api(`/admin/products?q=${encodeURIComponent(it.trim())}&limit=20&orderBy=name-asc`);z&&lt(mt)}catch{z&&lt([])}},250);return()=>{z=!1,clearTimeout(at)}},[it]),reactExports.useEffect(()=>{let z=!0;if(!he.trim()){pe([]);return}const at=setTimeout(async()=>{try{const mt=await api(`/admin/products?q=${encodeURIComponent(he.trim())}&limit=20&orderBy=name-asc`);z&&pe(mt)}catch{z&&pe([])}},250);return()=>{z=!1,clearTimeout(at)}},[he]);const Ce=reactExports.useMemo(()=>{const z=N.reduce((at,mt)=>{const Pt=Number(mt.unitPrice||0)*Number(mt.qty||0),St=Number(mt.taxRate||0),Ht=Number(mt.exciseTotal??Number(mt.exciseMl||0)+Number(mt.exciseProduct||0))*Number(mt.qty||0),ae=St>0?(Pt+Ht)*(St/100):0;return{subtotal:at.subtotal+Pt,vat:at.vat+ae,excise:at.excise+Ht}},{subtotal:0,vat:0,excise:0});return{...z,total:z.subtotal+z.vat+z.excise}},[N]),ie=reactExports.useMemo(()=>{const z=Rt.reduce((at,mt)=>{const Pt=Number(mt.unitPrice||0)*Number(mt.qty||0),St=Number(mt.taxRate||0),Ht=Number(mt.exciseTotal??Number(mt.exciseMl||0)+Number(mt.exciseProduct||0))*Number(mt.qty||0),ae=St>0?(Pt+Ht)*(St/100):0;return{subtotal:at.subtotal+Pt,vat:at.vat+ae,excise:at.excise+Ht}},{subtotal:0,vat:0,excise:0});return{...z,total:z.subtotal+z.vat+z.excise}},[Rt]),de=reactExports.useMemo(()=>[...e].sort((z,at)=>{const mt=STATUS_SORT_PRIORITY[z.status]??99,Pt=STATUS_SORT_PRIORITY[at.status]??99;return mt!==Pt?mt-Pt:new Date(at.createdAt||0).getTime()-new Date(z.createdAt||0).getTime()}),[e]);function ke(z){F(at=>at.find(Pt=>Pt.productId===z.id)?at.map(Pt=>Pt.productId===z.id?{...Pt,qty:Pt.qty+1}:Pt):[...at,{productId:z.id,sku:z.sku,name:z.name,unitPrice:Number(z.price||0),qty:1,taxRate:Number(z.taxRate||z.taxRateRef?.rate||0),exciseTotal:z.exciseTotal,exciseMl:z.exciseMl,exciseProduct:z.exciseProduct}])}function Ue(z,at){F(mt=>mt.map(Pt=>Pt.productId===z?{...Pt,...at}:Pt))}function L(z){F(at=>at.filter(mt=>mt.productId!==z))}function st(z){ye(at=>at.find(Pt=>Pt.productId===z.id)?at.map(Pt=>Pt.productId===z.id?{...Pt,qty:Pt.qty+1}:Pt):[...at,{productId:z.id,sku:z.sku,name:z.name,unitPrice:Number(z.price||0),qty:1,taxRate:Number(z.taxRate||z.taxRateRef?.rate||0),exciseTotal:z.exciseTotal,exciseMl:z.exciseMl,exciseProduct:z.exciseProduct}])}function At(z,at){ye(mt=>mt.map(Pt=>Pt.productId===z?{...Pt,...at}:Pt))}function Bt(z){ye(at=>at.filter(mt=>mt.productId!==z))}async function W(){if(!U||!N.length){c("Seleziona un'azienda e aggiungi almeno un prodotto");return}pt(!0);try{await api("/admin/orders",{method:"POST",body:JSON.stringify({companyId:U,status:ht,paymentMethod:bt,items:N.map(z=>({productId:z.productId,qty:Number(z.qty||1),unitPrice:Number(z.unitPrice||0)}))})}),y(!1),F([]),Et(""),await Kt(),await ue()}catch{c("Impossibile creare ordine")}finally{pt(!1)}}async function Yt(z,at){try{await api(`/admin/orders/${z}`,{method:"PATCH",body:JSON.stringify({status:at})}),await Kt(),await ue()}catch{c("Impossibile aggiornare lo stato")}}async function Ft(){if(A.length)try{await api("/admin/orders/bulk-status",{method:"PATCH",body:JSON.stringify({ids:A,status:q})}),await Kt(),await ue()}catch{c("Impossibile aggiornare ordini selezionati")}}async function me(){if(C){pt(!0);try{await api(`/admin/orders/${C.id}`,{method:"PATCH",body:JSON.stringify({companyId:Tt,status:Dt,paymentMethod:$t,items:Rt.map(z=>({productId:z.productId,qty:Number(z.qty||1),unitPrice:Number(z.unitPrice||0)}))})}),M(null),await Kt()}catch{c("Impossibile salvare ordine")}finally{pt(!1)}}}async function Qe(){if(!(!C||!window.confirm("Vuoi eliminare questo ordine?"))){pt(!0);try{await api(`/admin/orders/${C.id}`,{method:"DELETE"}),M(null),await Kt(),await ue()}catch{c("Impossibile eliminare ordine")}finally{pt(!1)}}}function Me(z){return z==="SUBMITTED"?{label:"In attesa pagamento",cls:"status pending"}:z==="APPROVED"?{label:"Elaborazione",cls:"status processing"}:z==="FULFILLED"?{label:"Completato",cls:"status completed"}:z==="CANCELLED"?{label:"Fallito",cls:"status failed"}:{label:"Bozza",cls:"status draft"}}function tt(z){return PAYMENT_OPTIONS.find(at=>at.value===z)?.label||z||"-"}const rt=reactExports.useMemo(()=>Array.from(new Set((r||[]).map(z=>z.groupName).filter(Boolean))).sort((z,at)=>String(z).localeCompare(String(at),"it")),[r]);return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Ordini"}),jsxRuntimeExports.jsx("p",{children:"Gestione ordini B2B"})]}),jsxRuntimeExports.jsx("div",{className:"page-actions",children:jsxRuntimeExports.jsx("button",{className:"primary order-cta",onClick:()=>y(!0),children:"Crea ordine manuale"})})]}),jsxRuntimeExports.jsx(InlineError,{message:o,onClose:()=>c("")}),jsxRuntimeExports.jsxs("div",{className:"filters-row",children:[jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"Stato"}),jsxRuntimeExports.jsxs("select",{value:u,onChange:z=>x(z.target.value),children:[jsxRuntimeExports.jsx("option",{value:"ALL",children:"Tutti"}),STATUS_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))]})]}),jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"Pagamento"}),jsxRuntimeExports.jsxs("select",{value:m,onChange:z=>f(z.target.value),children:[jsxRuntimeExports.jsx("option",{value:"ALL",children:"Tutti"}),PAYMENT_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))]})]}),jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"Cliente"}),jsxRuntimeExports.jsxs("select",{value:g,onChange:z=>R(z.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Tutti"}),r.map(z=>jsxRuntimeExports.jsx("option",{value:z.id,children:z.name},z.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"Gruppo cliente"}),jsxRuntimeExports.jsxs("select",{value:j,onChange:z=>P(z.target.value),children:[jsxRuntimeExports.jsx("option",{value:"ALL",children:"Tutti"}),rt.map(z=>jsxRuntimeExports.jsx("option",{value:z,children:z},z))]})]}),jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"Da"}),jsxRuntimeExports.jsx("input",{type:"date",value:S,onChange:z=>b(z.target.value)})]}),jsxRuntimeExports.jsxs("div",{className:"filter-group",children:[jsxRuntimeExports.jsx("label",{children:"A"}),jsxRuntimeExports.jsx("input",{type:"date",value:I,onChange:z=>E(z.target.value)})]})]}),jsxRuntimeExports.jsx("div",{className:"orders-stats",children:$.map(z=>{const at=Me(z.status);return jsxRuntimeExports.jsxs("div",{className:`orders-stat-card ${at.cls}`,children:[jsxRuntimeExports.jsx("span",{children:at.label}),jsxRuntimeExports.jsx("strong",{children:z.count})]},z.status)})}),jsxRuntimeExports.jsxs("div",{className:"orders-bulk-row",children:[jsxRuntimeExports.jsx("select",{value:q,onChange:z=>D(z.target.value),children:STATUS_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))}),jsxRuntimeExports.jsxs("button",{className:"btn ghost",onClick:Ft,disabled:!A.length,children:["Modifica selezionati (",A.length,")"]})]}),jsxRuntimeExports.jsxs("div",{className:"orders-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:de.length>0&&A.length===de.length,onChange:z=>O(z.target.checked?de.map(at=>at.id):[])})}),jsxRuntimeExports.jsx("div",{children:"Ordine #"}),jsxRuntimeExports.jsx("div",{children:"Azienda"}),jsxRuntimeExports.jsx("div",{children:"Referente"}),jsxRuntimeExports.jsx("div",{children:"Stato"}),jsxRuntimeExports.jsx("div",{children:"Pagamento"}),jsxRuntimeExports.jsx("div",{children:"Totale"}),jsxRuntimeExports.jsx("div",{children:"Creato"}),jsxRuntimeExports.jsx("div",{})]}),de.map(z=>jsxRuntimeExports.jsxs("div",{className:"row",onClick:()=>G(z),children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:A.includes(z.id),onClick:at=>at.stopPropagation(),onChange:at=>O(mt=>at.target.checked?[...mt,z.id]:mt.filter(Pt=>Pt!==z.id))})}),jsxRuntimeExports.jsx("div",{className:"mono",children:z.orderNumber||"-"}),jsxRuntimeExports.jsx("div",{children:z.company?.name||"-"}),jsxRuntimeExports.jsx("div",{children:z.company?.contactFirstName||z.company?.contactLastName?`${z.company?.contactFirstName||""} ${z.company?.contactLastName||""}`.trim():z.company?.email||"-"}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("span",{className:Me(z.status).cls,children:Me(z.status).label})}),jsxRuntimeExports.jsx("div",{children:tt(z.paymentMethod)}),jsxRuntimeExports.jsx("div",{children:formatCurrency(z.total)}),jsxRuntimeExports.jsx("div",{children:new Date(z.createdAt).toLocaleString()}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:at=>{at.stopPropagation(),Yt(z.id,"APPROVED")},children:"In elaborazione"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:at=>{at.stopPropagation(),se(z)},children:"Completato"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:at=>{at.stopPropagation(),M(z)},children:"Modifica"})]})]},z.id))]}),oe?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>se(null),children:jsxRuntimeExports.jsxs("div",{className:"modal confirm-dialog",onClick:z=>z.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{children:"Conferma completamento"}),jsxRuntimeExports.jsxs("p",{children:["Sei sicuro di voler segnare come completato l'ordine"," ",jsxRuntimeExports.jsx("strong",{children:oe.orderNumber||oe.id}),"?"]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>se(null),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:async()=>{const z=oe.id;se(null),await Yt(z,"FULFILLED")},children:"Conferma"})]})]})})}):null,k?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>y(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal order-modal shopify-modal",onClick:z=>z.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Crea ordine manuale"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:"Compila i dettagli e aggiungi i prodotti"})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>y(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body",children:jsxRuntimeExports.jsxs("div",{className:"order-layout",children:[jsxRuntimeExports.jsxs("div",{className:"order-left",children:[jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Dettagli ordine"}),jsxRuntimeExports.jsxs("div",{className:"order-form",children:[jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Azienda"}),jsxRuntimeExports.jsx("select",{value:U,onChange:z=>H(z.target.value),children:r.map(z=>jsxRuntimeExports.jsx("option",{value:z.id,children:z.name},z.id))})]}),jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Stato ordine"}),jsxRuntimeExports.jsx("select",{value:ht,onChange:z=>dt(z.target.value),children:STATUS_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))})]}),jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Metodo pagamento"}),jsxRuntimeExports.jsx("select",{value:bt,onChange:z=>Ct(z.target.value),children:PAYMENT_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Righe ordine"}),jsxRuntimeExports.jsxs("div",{className:"order-lines",children:[jsxRuntimeExports.jsxs("div",{className:"order-lines-header",children:[jsxRuntimeExports.jsx("div",{children:"Prodotto"}),jsxRuntimeExports.jsx("div",{children:"Prezzo"}),jsxRuntimeExports.jsx("div",{children:"Qta"}),jsxRuntimeExports.jsx("div",{children:"Totale"}),jsxRuntimeExports.jsx("div",{})]}),N.map(z=>jsxRuntimeExports.jsxs("div",{className:"order-line",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"line-title",children:z.name}),jsxRuntimeExports.jsx("div",{className:"line-meta mono",children:z.sku})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:z.unitPrice,onChange:at=>Ue(z.productId,{unitPrice:Number(at.target.value)})})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",min:"1",value:z.qty,onChange:at=>Ue(z.productId,{qty:Number(at.target.value)})})}),jsxRuntimeExports.jsx("div",{children:formatCurrency(Number(z.unitPrice||0)*Number(z.qty||0))}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>L(z.productId),children:"Rimuovi"})})]},z.productId)),N.length?null:jsxRuntimeExports.jsx("div",{className:"empty",children:"Aggiungi prodotti per creare l'ordine."})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-right",children:[jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Aggiungi prodotti"}),jsxRuntimeExports.jsxs("div",{className:"order-search",children:[jsxRuntimeExports.jsxs("div",{className:"order-search-header",children:[jsxRuntimeExports.jsx("label",{children:"Cerca prodotto"}),jsxRuntimeExports.jsx("span",{className:"muted",children:"Seleziona per aggiungere alle righe ordine"})]}),jsxRuntimeExports.jsxs("div",{className:"order-search-grid",children:[jsxRuntimeExports.jsx("div",{className:"order-search-input",children:jsxRuntimeExports.jsx("input",{type:"search",placeholder:"SKU o nome prodotto",value:it,onChange:z=>Et(z.target.value)})}),jsxRuntimeExports.jsx("div",{className:"order-results",children:vt.length?vt.map(z=>jsxRuntimeExports.jsxs("button",{className:"result-item",onClick:()=>ke(z),children:[jsxRuntimeExports.jsx("div",{className:"result-title",children:z.name}),jsxRuntimeExports.jsxs("div",{className:"result-meta",children:[jsxRuntimeExports.jsx("span",{className:"mono",children:z.sku}),jsxRuntimeExports.jsx("span",{children:formatCurrency(z.price)})]})]},z.id)):jsxRuntimeExports.jsx("div",{className:"empty small",children:"Nessun risultato"})})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-card order-summary-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Riepilogo"}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Subtotale"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(Ce.subtotal)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"IVA"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(Ce.vat)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Accise"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(Ce.excise)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row total",children:[jsxRuntimeExports.jsx("span",{children:"Totale ordine"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(Ce.total)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>y(!1),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:W,disabled:J,children:J?"Salvataggio...":"Crea ordine"})]})]})]})]})})]})})}):null,B?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>G(null),children:jsxRuntimeExports.jsxs("div",{className:"modal order-modal shopify-modal",onClick:z=>z.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Riepilogo ordine"}),jsxRuntimeExports.jsxs("div",{className:"modal-subtitle",children:["#",B.orderNumber||"-"," • ",B.company?.name||"-"]})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>G(null),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body",children:jsxRuntimeExports.jsxs("div",{className:"order-layout",children:[jsxRuntimeExports.jsxs("div",{className:"order-left",children:[jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Dettagli"}),jsxRuntimeExports.jsxs("div",{className:"summary-grid",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Stato"}),jsxRuntimeExports.jsx("div",{children:Me(B.status).label})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Pagamento"}),jsxRuntimeExports.jsx("div",{children:tt(B.paymentMethod)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Creato"}),jsxRuntimeExports.jsx("div",{children:new Date(B.createdAt).toLocaleString()})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"Referente"}),jsxRuntimeExports.jsx("div",{children:B.company?.contactFirstName||B.company?.contactLastName?`${B.company?.contactFirstName||""} ${B.company?.contactLastName||""}`.trim():B.company?.email||"-"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Righe ordine"}),jsxRuntimeExports.jsxs("div",{className:"order-lines",children:[jsxRuntimeExports.jsxs("div",{className:"order-lines-header",children:[jsxRuntimeExports.jsx("div",{children:"Prodotto"}),jsxRuntimeExports.jsx("div",{children:"Prezzo"}),jsxRuntimeExports.jsx("div",{children:"Qta"}),jsxRuntimeExports.jsx("div",{children:"Totale"}),jsxRuntimeExports.jsx("div",{children:"Fornitore"})]}),(B.items||[]).map(z=>jsxRuntimeExports.jsxs("div",{className:"order-line",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"line-title",children:z.name}),jsxRuntimeExports.jsx("div",{className:"line-meta mono",children:z.sku})]}),jsxRuntimeExports.jsx("div",{children:formatCurrency(z.unitPrice)}),jsxRuntimeExports.jsx("div",{children:z.qty}),jsxRuntimeExports.jsx("div",{children:formatCurrency(z.lineTotal)}),jsxRuntimeExports.jsx("div",{children:z.product?.sourceSupplier?.name||"-"})]},z.id)),B.items?.length?null:jsxRuntimeExports.jsx("div",{className:"empty",children:"Nessuna riga ordine."})]})]})]}),jsxRuntimeExports.jsx("div",{className:"order-right",children:jsxRuntimeExports.jsxs("div",{className:"order-card order-summary-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Totali"}),(()=>{const z=(B.items||[]).reduce((at,mt)=>{const Pt=Number(mt.lineTotal||0),St=Number(mt.qty||0),Qt=mt.product,Ht=Number(Qt?.taxRate||Qt?.taxRateRef?.rate||0),$e=Number(Qt?.exciseTotal??Number(Qt?.exciseMl||0)+Number(Qt?.exciseProduct||0))*St,ms=Ht>0?(Pt+$e)*(Ht/100):0;return at.revenue+=Pt,at.vat+=ms,at.excise+=$e,at},{revenue:0,vat:0,excise:0});return jsxRuntimeExports.jsxs("div",{className:"summary-stack",children:[jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Subtotale"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(z.revenue)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"IVA totale"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(z.vat)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Accise totali"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(z.excise)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row total",children:[jsxRuntimeExports.jsx("span",{children:"Totale ordine"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(z.revenue+z.vat+z.excise)})]})]})})()]})})]})})]})})}):null,C?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>M(null),children:jsxRuntimeExports.jsxs("div",{className:"modal order-modal shopify-modal",onClick:z=>z.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Modifica ordine"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:"Aggiorna dettagli, righe e stato"})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>M(null),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body",children:jsxRuntimeExports.jsxs("div",{className:"order-layout",children:[jsxRuntimeExports.jsxs("div",{className:"order-left",children:[jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Dettagli ordine"}),jsxRuntimeExports.jsxs("div",{className:"order-form",children:[jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Azienda"}),jsxRuntimeExports.jsx("select",{value:Tt,onChange:z=>K(z.target.value),children:r.map(z=>jsxRuntimeExports.jsx("option",{value:z.id,children:z.name},z.id))})]}),jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Stato ordine"}),jsxRuntimeExports.jsx("select",{value:Dt,onChange:z=>Lt(z.target.value),children:STATUS_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))})]}),jsxRuntimeExports.jsxs("div",{className:"field",children:[jsxRuntimeExports.jsx("label",{children:"Metodo pagamento"}),jsxRuntimeExports.jsx("select",{value:$t,onChange:z=>zt(z.target.value),children:PAYMENT_OPTIONS.map(z=>jsxRuntimeExports.jsx("option",{value:z.value,children:z.label},z.value))})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Righe ordine"}),jsxRuntimeExports.jsxs("div",{className:"order-lines",children:[jsxRuntimeExports.jsxs("div",{className:"order-lines-header",children:[jsxRuntimeExports.jsx("div",{children:"Prodotto"}),jsxRuntimeExports.jsx("div",{children:"Prezzo"}),jsxRuntimeExports.jsx("div",{children:"Qta"}),jsxRuntimeExports.jsx("div",{children:"Totale"}),jsxRuntimeExports.jsx("div",{})]}),Rt.map(z=>jsxRuntimeExports.jsxs("div",{className:"order-line",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"line-title",children:z.name}),jsxRuntimeExports.jsx("div",{className:"line-meta mono",children:z.sku})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:z.unitPrice,onChange:at=>At(z.productId,{unitPrice:Number(at.target.value)})})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",min:"1",value:z.qty,onChange:at=>At(z.productId,{qty:Number(at.target.value)})})}),jsxRuntimeExports.jsx("div",{children:formatCurrency(Number(z.unitPrice||0)*Number(z.qty||0))}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>Bt(z.productId),children:"Rimuovi"})})]},z.productId)),Rt.length?null:jsxRuntimeExports.jsx("div",{className:"empty",children:"Aggiungi prodotti per creare l'ordine."})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-right",children:[jsxRuntimeExports.jsxs("div",{className:"order-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Aggiungi prodotti"}),jsxRuntimeExports.jsxs("div",{className:"order-search",children:[jsxRuntimeExports.jsxs("div",{className:"order-search-header",children:[jsxRuntimeExports.jsx("label",{children:"Cerca prodotto"}),jsxRuntimeExports.jsx("span",{className:"muted",children:"Seleziona per aggiungere alle righe ordine"})]}),jsxRuntimeExports.jsxs("div",{className:"order-search-grid",children:[jsxRuntimeExports.jsx("div",{className:"order-search-input",children:jsxRuntimeExports.jsx("input",{type:"search",placeholder:"SKU o nome prodotto",value:he,onChange:z=>ce(z.target.value)})}),jsxRuntimeExports.jsx("div",{className:"order-results",children:Xt.length?Xt.map(z=>jsxRuntimeExports.jsxs("button",{className:"result-item",onClick:()=>st(z),children:[jsxRuntimeExports.jsx("div",{className:"result-title",children:z.name}),jsxRuntimeExports.jsxs("div",{className:"result-meta",children:[jsxRuntimeExports.jsx("span",{className:"mono",children:z.sku}),jsxRuntimeExports.jsx("span",{children:formatCurrency(z.price)})]})]},z.id)):jsxRuntimeExports.jsx("div",{className:"empty small",children:"Nessun risultato"})})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"order-card order-summary-card",children:[jsxRuntimeExports.jsx("div",{className:"card-title",children:"Riepilogo"}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Subtotale"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(ie.subtotal)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"IVA"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(ie.vat)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row",children:[jsxRuntimeExports.jsx("span",{children:"Accise"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(ie.excise)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-row total",children:[jsxRuntimeExports.jsx("span",{children:"Totale ordine"}),jsxRuntimeExports.jsx("strong",{children:formatCurrency(ie.total)})]}),jsxRuntimeExports.jsxs("div",{className:"summary-actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>M(null),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:Qe,disabled:J,children:"Elimina"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:me,disabled:J,children:J?"Salvataggio...":"Salva"})]})]})]})]})})]})})}):null]})}function AdminUsers(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState("");reactExports.useEffect(()=>{let c=!0;async function u(){try{const x=await api("/admin/users");if(!c)return;i(x||[])}catch{n("Impossibile caricare utenti admin")}}return u(),()=>{c=!1}},[]);const o=e.filter(c=>c.role==="ADMIN"||c.role==="MANAGER");return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"page-header",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Utenti admin"}),jsxRuntimeExports.jsx("p",{children:"Account amministrativi e manager"})]})}),jsxRuntimeExports.jsx(InlineError,{message:r,onClose:()=>n("")}),jsxRuntimeExports.jsxs("div",{className:"table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Email"}),jsxRuntimeExports.jsx("div",{children:"Ruolo"}),jsxRuntimeExports.jsx("div",{children:"Azienda"})]}),o.length===0?jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Nessun utente admin"}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{})]}):o.map(c=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:c.email}),jsxRuntimeExports.jsx("div",{children:c.role}),jsxRuntimeExports.jsx("div",{children:c.company?.name||"—"})]},c.id))]})]})}function AdminSettings(){const[e,i]=reactExports.useState(""),[r,n]=reactExports.useState(!1),[o,c]=reactExports.useState([]),[u,x]=reactExports.useState([]),[m,f]=reactExports.useState({name:"",rate:""}),[g,R]=reactExports.useState({name:"",type:"ML",amount:""}),[j,P]=reactExports.useState(""),[S,b]=reactExports.useState({name:"",type:"ML",amount:""}),[I,E]=reactExports.useState({vatRateDefault:""});reactExports.useEffect(()=>{let U=!0;async function H(){try{const[ht,dt,it]=await Promise.all([api("/admin/settings"),api("/admin/taxes"),api("/admin/excises")]);if(!U)return;E({vatRateDefault:ht?.vatRateDefault??""}),c(dt||[]),x(it||[])}catch{i("Impossibile caricare le impostazioni")}}return H(),()=>{U=!1}},[]);async function k(){n(!0),i("");try{await api("/admin/settings",{method:"PATCH",body:JSON.stringify({vatRateDefault:I.vatRateDefault===""?void 0:Number(I.vatRateDefault)})})}catch{i("Errore salvataggio impostazioni")}finally{n(!1)}}async function y(){if(!(!m.name.trim()||m.rate===""))try{const U=await api("/admin/taxes",{method:"POST",body:JSON.stringify({name:m.name.trim(),rate:Number(m.rate)})});c(H=>[...H,U]),f({name:"",rate:""})}catch{i("Errore creazione IVA")}}async function C(){if(!(!g.name.trim()||g.amount===""))try{const U=await api("/admin/excises",{method:"POST",body:JSON.stringify({name:g.name.trim(),type:g.type,amount:Number(g.amount)})});x(H=>[...H,U]),R({name:"",type:"ML",amount:""})}catch{i("Errore creazione accisa")}}async function M(U){try{await api(`/admin/taxes/${U}`,{method:"DELETE"}),c(H=>H.filter(ht=>ht.id!==U))}catch{i("Errore eliminazione IVA")}}async function B(U){try{await api(`/admin/excises/${U}`,{method:"DELETE"}),x(H=>H.filter(ht=>ht.id!==U))}catch{i("Errore eliminazione accisa")}}async function G(){if(j)try{const U={name:S.name.trim(),type:S.type,amount:Number(S.amount)},H=await api(`/admin/excises/${j}`,{method:"PATCH",body:JSON.stringify(U)});x(ht=>ht.map(dt=>dt.id===j?H:dt)),P("")}catch{i("Errore modifica accisa")}}return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Impostazioni"}),jsxRuntimeExports.jsx("p",{children:"Imposta i valori fiscali disponibili per il catalogo"})]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:k,disabled:r,children:r?"Salvataggio...":"Salva"})})]}),jsxRuntimeExports.jsx(InlineError,{message:e,onClose:()=>i("")}),jsxRuntimeExports.jsx("div",{className:"panel",children:jsxRuntimeExports.jsx("div",{className:"form-grid",children:jsxRuntimeExports.jsxs("label",{children:["IVA default (%)",jsxRuntimeExports.jsxs("select",{className:"select",value:I.vatRateDefault,onChange:U=>E({...I,vatRateDefault:U.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleziona IVA di default"}),o.map(U=>jsxRuntimeExports.jsxs("option",{value:Number(U.rate).toFixed(2),children:[U.name," (",Number(U.rate).toFixed(2),"%)"]},U.id))]})]})})}),jsxRuntimeExports.jsxs("div",{className:"panel",children:[jsxRuntimeExports.jsx("h3",{children:"Aliquote IVA"}),jsxRuntimeExports.jsxs("div",{className:"form-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Nome",jsxRuntimeExports.jsx("input",{value:m.name,onChange:U=>f({...m,name:U.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Aliquota %",jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:m.rate,onChange:U=>f({...m,rate:U.target.value})})]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:y,children:"Aggiungi IVA"})})]}),jsxRuntimeExports.jsxs("div",{className:"table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Aliquota"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),o.map(U=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:U.name}),jsxRuntimeExports.jsxs("div",{children:[Number(U.rate).toFixed(2),"%"]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:()=>M(U.id),children:"Elimina"})})]},U.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"panel",children:[jsxRuntimeExports.jsx("h3",{children:"Accise"}),jsxRuntimeExports.jsxs("div",{className:"form-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Nome",jsxRuntimeExports.jsx("input",{value:g.name,onChange:U=>R({...g,name:U.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Tipo",jsxRuntimeExports.jsxs("select",{value:g.type,onChange:U=>R({...g,type:U.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"ML",children:"Per ML"}),jsxRuntimeExports.jsx("option",{value:"PRODUCT",children:"Per prodotto"})]})]}),jsxRuntimeExports.jsxs("label",{children:["Importo",jsxRuntimeExports.jsx("input",{type:"number",step:"0.000001",value:g.amount,onChange:U=>R({...g,amount:U.target.value})})]}),jsxRuntimeExports.jsx("div",{className:"actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:C,children:"Aggiungi accisa"})})]}),jsxRuntimeExports.jsxs("div",{className:"table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Tipo"}),jsxRuntimeExports.jsx("div",{children:"Importo"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),u.map(U=>jsxRuntimeExports.jsx("div",{className:"row",children:j===U.id?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{value:S.name,onChange:H=>b({...S,name:H.target.value})})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("select",{value:S.type,onChange:H=>b({...S,type:H.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"ML",children:"Per ML"}),jsxRuntimeExports.jsx("option",{value:"PRODUCT",children:"Per prodotto"})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",step:"0.000001",value:S.amount,onChange:H=>b({...S,amount:H.target.value})})}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>P(""),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:G,children:"Salva"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{children:U.name}),jsxRuntimeExports.jsx("div",{children:U.type==="ML"?"Per ML":"Per prodotto"}),jsxRuntimeExports.jsx("div",{children:Number(U.amount).toFixed(6)}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>{P(U.id),b({name:U.name,type:U.type,amount:Number(U.amount).toFixed(6)})},children:"Modifica"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:()=>B(U.id),children:"Elimina"})]})]})},U.id))]})]})]})}function AdminCompanies(){const[e,i]=reactExports.useState([]),[r,n]=reactExports.useState([]),[o,c]=reactExports.useState(""),[u,x]=reactExports.useState(!1),[m,f]=reactExports.useState(!1),[g,R]=reactExports.useState(null),[j,P]=reactExports.useState(!1),[S,b]=reactExports.useState(null),[I,E]=reactExports.useState(null),[k,y]=reactExports.useState(""),[C,M]=reactExports.useState(""),[B,G]=reactExports.useState(""),[U,H]=reactExports.useState(""),[ht,dt]=reactExports.useState(""),[it,Et]=reactExports.useState(""),[vt,lt]=reactExports.useState(""),[N,F]=reactExports.useState(""),[A,O]=reactExports.useState(""),[q,D]=reactExports.useState(""),[$,Y]=reactExports.useState(""),[J,pt]=reactExports.useState(""),[bt,Ct]=reactExports.useState(""),[Tt,K]=reactExports.useState(""),[Dt,Lt]=reactExports.useState(""),[$t,zt]=reactExports.useState(""),[Rt,ye]=reactExports.useState(""),[he,ce]=reactExports.useState(""),[Xt,pe]=reactExports.useState(""),[oe,se]=reactExports.useState("all");async function Kt(){try{const[W,Yt]=await Promise.all([api("/admin/users/pending"),api("/admin/companies")]);i(W||[]),n(Yt||[])}catch{c("Impossibile caricare aziende")}}reactExports.useEffect(()=>{Kt()},[]);const ue=reactExports.useMemo(()=>{let W=[...r];oe!=="all"&&(W=W.filter(Ft=>String(Ft.status||"").toUpperCase()===oe));const Yt=Xt.trim().toLowerCase();return Yt&&(W=W.filter(Ft=>[Ft.name,Ft.legalName,Ft.vatNumber,Ft.email,Ft.customerCode,Ft.contactFirstName,Ft.contactLastName].filter(Boolean).join(" ").toLowerCase().includes(Yt))),W},[r,Xt,oe]);function Zt(W){return new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR",maximumFractionDigits:2}).format(Number(W||0))}function Ce(W){return W?new Date(W).toLocaleString("it-IT"):"—"}async function ie(W){try{await api(`/admin/users/${W}/approve`,{method:"PATCH"}),Kt()}catch{c("Errore approvazione richiesta")}}async function de(W){try{await api(`/admin/users/${W}/reject`,{method:"DELETE"}),Kt()}catch{c("Errore rifiuto richiesta")}}function ke(W){b(W),P(!0)}function Ue(W){R({...W}),f(!0)}async function L(){if(g)try{const W={name:g.name||"",vatNumber:g.vatNumber||null,contactFirstName:g.contactFirstName||null,contactLastName:g.contactLastName||null,legalName:g.legalName||null,sdiCode:g.sdiCode||null,address:g.address||null,cap:g.cap||null,city:g.city||null,province:g.province||null,phone:g.phone||null,email:g.email||null,customerCode:g.customerCode||null,pec:g.pec||null,licenseNumber:g.licenseNumber||null,cmnr:g.cmnr||null,signNumber:g.signNumber||null,adminVatNumber:g.adminVatNumber||null,status:g.status||"ACTIVE"};await api(`/admin/companies/${g.id}`,{method:"PATCH",body:JSON.stringify(W)}),f(!1),R(null),Kt()}catch{c("Errore salvataggio azienda")}}async function st(W){if(g)try{await api(`/admin/companies/${g.id}`,{method:"PATCH",body:JSON.stringify({status:W})}),R({...g,status:W}),Kt()}catch{c("Errore aggiornamento stato")}}async function At(){if(g)try{await api(`/admin/companies/${g.id}`,{method:"DELETE"}),f(!1),R(null),Kt()}catch{c("Impossibile eliminare azienda (ha ordini?)")}}async function Bt(){if(!k.trim()||!C.trim()||!B.trim()||!U.trim()||!ht.trim()||!it.trim()||!vt.trim()||!N.trim()||!A.trim()||!q.trim()||!$.trim()||!J.trim()){c("Compila tutti i campi obbligatori");return}try{await api("/admin/companies",{method:"POST",body:JSON.stringify({name:k.trim(),vatNumber:C.trim(),contactFirstName:B.trim(),contactLastName:U.trim(),legalName:ht.trim(),sdiCode:it.trim(),address:vt.trim(),cap:N.trim(),city:A.trim(),province:q.trim(),phone:$.trim(),email:J.trim(),customerCode:bt.trim()||void 0,pec:Tt.trim()||void 0,licenseNumber:Dt.trim()||void 0,cmnr:$t.trim()||void 0,signNumber:Rt.trim()||void 0,adminVatNumber:he.trim()||void 0,status:"ACTIVE"})}),y(""),M(""),G(""),H(""),dt(""),Et(""),lt(""),F(""),O(""),D(""),Y(""),pt(""),Ct(""),K(""),Lt(""),zt(""),ye(""),ce(""),x(!1),Kt()}catch{c("Errore creazione azienda")}}return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Clienti / Aziende"}),jsxRuntimeExports.jsx("p",{children:"Gestisci aziende B2B e richieste di accesso"})]}),jsxRuntimeExports.jsx("div",{className:"page-actions",children:jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>x(!0),children:"Crea azienda"})})]}),jsxRuntimeExports.jsx(InlineError,{message:o,onClose:()=>c("")}),jsxRuntimeExports.jsxs("div",{className:"panel",children:[jsxRuntimeExports.jsx("h3",{children:"Richieste in attesa"}),jsxRuntimeExports.jsxs("div",{className:"table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Email"}),jsxRuntimeExports.jsx("div",{children:"Ruolo"}),jsxRuntimeExports.jsx("div",{children:"Azioni"})]}),e.length===0?jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Nessuna richiesta"}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{})]}):e.map(W=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:W.email}),jsxRuntimeExports.jsx("div",{children:W.role}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>ke(W),children:"Vedi dettagli"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>ie(W.id),children:"Approva"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:()=>E(W),children:"Rifiuta"})]})]},W.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"panel",children:[jsxRuntimeExports.jsxs("div",{className:"actions",style:{justifyContent:"space-between",marginBottom:10},children:[jsxRuntimeExports.jsx("h3",{style:{margin:0},children:"Aziende"}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("input",{placeholder:"Cerca cliente (nome, P.IVA, email...)",value:Xt,onChange:W=>pe(W.target.value),style:{minWidth:280}}),jsxRuntimeExports.jsxs("select",{className:"select",value:oe,onChange:W=>se(W.target.value),children:[jsxRuntimeExports.jsx("option",{value:"all",children:"Tutti"}),jsxRuntimeExports.jsx("option",{value:"ACTIVE",children:"Attivi"}),jsxRuntimeExports.jsx("option",{value:"PENDING",children:"In attesa"}),jsxRuntimeExports.jsx("option",{value:"SUSPENDED",children:"Revocati"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"table companies-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Ragione sociale"}),jsxRuntimeExports.jsx("div",{children:"P.IVA"}),jsxRuntimeExports.jsx("div",{children:"Referente"}),jsxRuntimeExports.jsx("div",{children:"Email"}),jsxRuntimeExports.jsx("div",{children:"Ultimo accesso"}),jsxRuntimeExports.jsx("div",{children:"Registrazione"}),jsxRuntimeExports.jsx("div",{children:"Ordini"}),jsxRuntimeExports.jsx("div",{children:"Fatturato"}),jsxRuntimeExports.jsx("div",{children:"Media ordini"}),jsxRuntimeExports.jsx("div",{children:"Stato"})]}),ue.length===0?jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Nessuna azienda presente"}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{})]}):ue.map(W=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:W.legalName||W.name}),jsxRuntimeExports.jsx("div",{children:W.vatNumber||"—"}),jsxRuntimeExports.jsx("div",{children:(W.contactFirstName||"")+" "+(W.contactLastName||"")}),jsxRuntimeExports.jsx("div",{children:W.email||"—"}),jsxRuntimeExports.jsx("div",{children:Ce(W?.stats?.lastAccessAt)}),jsxRuntimeExports.jsx("div",{children:Ce(W?.stats?.registeredAt||W.createdAt)}),jsxRuntimeExports.jsx("div",{children:W?.stats?.orders??0}),jsxRuntimeExports.jsx("div",{children:Zt(W?.stats?.revenue??0)}),jsxRuntimeExports.jsx("div",{children:Zt(W?.stats?.averageOrderValue??0)}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("span",{className:`tag ${W.status==="SUSPENDED"?"danger":W.status==="PENDING"?"warn":"success"}`,children:W.status==="SUSPENDED"?"Revocata":W.status==="PENDING"?"In attesa":"Attivo"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>Ue(W),children:"Modifica"})]})]},W.id))]})]}),j&&S?jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>P(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:W=>W.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Dettagli richiesta"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:S.email})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>P(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body modal-body-single",children:[jsxRuntimeExports.jsxs("div",{className:"rules-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Ragione sociale",jsxRuntimeExports.jsx("input",{value:S.company?.legalName||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Partita IVA",jsxRuntimeExports.jsx("input",{value:S.company?.vatNumber||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Referente",jsxRuntimeExports.jsx("input",{value:`${S.company?.contactFirstName||""} ${S.company?.contactLastName||""}`,disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["SDI",jsxRuntimeExports.jsx("input",{value:S.company?.sdiCode||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Indirizzo",jsxRuntimeExports.jsx("input",{value:S.company?.address||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["CAP",jsxRuntimeExports.jsx("input",{value:S.company?.cap||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Città",jsxRuntimeExports.jsx("input",{value:S.company?.city||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Provincia",jsxRuntimeExports.jsx("input",{value:S.company?.province||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Telefono",jsxRuntimeExports.jsx("input",{value:S.company?.phone||"",disabled:!0})]}),jsxRuntimeExports.jsxs("label",{children:["Email azienda",jsxRuntimeExports.jsx("input",{value:S.company?.email||"",disabled:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>P(!1),children:"Chiudi"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:()=>ie(S.id),children:"Approva"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:()=>E(S),children:"Rifiuta"})]})]})]})}):null,I?jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>E(null),children:jsxRuntimeExports.jsxs("div",{className:"modal modal-compact",onClick:W=>W.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Rifiuta richiesta"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:"Sei sicuro di voler rifiutare questa richiesta?"})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>E(null),children:"Chiudi"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body modal-body-single",children:jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>E(null),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:async()=>{const W=I.id;E(null),await de(W)},children:"Rifiuta"})]})})]})}):null,u?jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>x(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:W=>W.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Crea azienda"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:"Inserisci i dati principali"})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>x(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body modal-body-single",children:[jsxRuntimeExports.jsxs("div",{className:"rules-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Nome azienda",jsxRuntimeExports.jsx("input",{value:k,onChange:W=>y(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Ragione sociale",jsxRuntimeExports.jsx("input",{value:ht,onChange:W=>dt(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Nome referente",jsxRuntimeExports.jsx("input",{value:B,onChange:W=>G(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Cognome referente",jsxRuntimeExports.jsx("input",{value:U,onChange:W=>H(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Partita IVA",jsxRuntimeExports.jsx("input",{value:C,onChange:W=>M(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Codice univoco SDI",jsxRuntimeExports.jsx("input",{value:it,onChange:W=>Et(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Indirizzo",jsxRuntimeExports.jsx("input",{value:vt,onChange:W=>lt(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["CAP",jsxRuntimeExports.jsx("input",{value:N,onChange:W=>F(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Città",jsxRuntimeExports.jsx("input",{value:A,onChange:W=>O(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Provincia",jsxRuntimeExports.jsx("input",{value:q,onChange:W=>D(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Telefono",jsxRuntimeExports.jsx("input",{value:$,onChange:W=>Y(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Email",jsxRuntimeExports.jsx("input",{value:J,onChange:W=>pt(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Codice cliente (opzionale)",jsxRuntimeExports.jsx("input",{value:bt,onChange:W=>Ct(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["PEC (opzionale)",jsxRuntimeExports.jsx("input",{value:Tt,onChange:W=>K(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Numero esercizio (opzionale)",jsxRuntimeExports.jsx("input",{value:Dt,onChange:W=>Lt(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["CMNR (opzionale)",jsxRuntimeExports.jsx("input",{value:$t,onChange:W=>zt(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["Numero insegna (opzionale)",jsxRuntimeExports.jsx("input",{value:Rt,onChange:W=>ye(W.target.value)})]}),jsxRuntimeExports.jsxs("label",{children:["CF/P.IVA ADM (opzionale)",jsxRuntimeExports.jsx("input",{value:he,onChange:W=>ce(W.target.value)})]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>x(!1),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:Bt,children:"Crea"})]})]})]})}):null,m&&g?jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>f(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal",onClick:W=>W.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:"Modifica azienda"}),jsxRuntimeExports.jsx("div",{className:"modal-subtitle",children:g.legalName||g.name})]}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>f(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body modal-body-single",children:[jsxRuntimeExports.jsxs("div",{className:"rules-grid",children:[jsxRuntimeExports.jsxs("label",{children:["Nome azienda",jsxRuntimeExports.jsx("input",{value:g.name||"",onChange:W=>R({...g,name:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Ragione sociale",jsxRuntimeExports.jsx("input",{value:g.legalName||"",onChange:W=>R({...g,legalName:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Nome referente",jsxRuntimeExports.jsx("input",{value:g.contactFirstName||"",onChange:W=>R({...g,contactFirstName:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Cognome referente",jsxRuntimeExports.jsx("input",{value:g.contactLastName||"",onChange:W=>R({...g,contactLastName:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Partita IVA",jsxRuntimeExports.jsx("input",{value:g.vatNumber||"",onChange:W=>R({...g,vatNumber:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Codice univoco SDI",jsxRuntimeExports.jsx("input",{value:g.sdiCode||"",onChange:W=>R({...g,sdiCode:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Indirizzo",jsxRuntimeExports.jsx("input",{value:g.address||"",onChange:W=>R({...g,address:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["CAP",jsxRuntimeExports.jsx("input",{value:g.cap||"",onChange:W=>R({...g,cap:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Città",jsxRuntimeExports.jsx("input",{value:g.city||"",onChange:W=>R({...g,city:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Provincia",jsxRuntimeExports.jsx("input",{value:g.province||"",onChange:W=>R({...g,province:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Telefono",jsxRuntimeExports.jsx("input",{value:g.phone||"",onChange:W=>R({...g,phone:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Email",jsxRuntimeExports.jsx("input",{value:g.email||"",onChange:W=>R({...g,email:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Codice cliente",jsxRuntimeExports.jsx("input",{value:g.customerCode||"",onChange:W=>R({...g,customerCode:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["PEC",jsxRuntimeExports.jsx("input",{value:g.pec||"",onChange:W=>R({...g,pec:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Numero esercizio",jsxRuntimeExports.jsx("input",{value:g.licenseNumber||"",onChange:W=>R({...g,licenseNumber:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["CMNR",jsxRuntimeExports.jsx("input",{value:g.cmnr||"",onChange:W=>R({...g,cmnr:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["Numero insegna",jsxRuntimeExports.jsx("input",{value:g.signNumber||"",onChange:W=>R({...g,signNumber:W.target.value})})]}),jsxRuntimeExports.jsxs("label",{children:["CF/P.IVA ADM",jsxRuntimeExports.jsx("input",{value:g.adminVatNumber||"",onChange:W=>R({...g,adminVatNumber:W.target.value})})]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[g.status==="SUSPENDED"?jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>st("ACTIVE"),children:"Ripristina accesso"}):jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>st("SUSPENDED"),children:"Revoca accesso"}),jsxRuntimeExports.jsx("button",{className:"btn danger",onClick:At,children:"Elimina"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:L,children:"Salva"})]})]})]})}):null]})}const money$1=e=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(Number(e||0)),initialForm={id:"",sku:"",name:"",description:"",shortDescription:"",brand:"",category:"",subcategory:"",barcode:"",nicotine:"",mlProduct:"",stockQty:0,purchasePrice:"",listPrice:"",price:"",taxRateId:"",exciseRateId:""};function AdminInventory(){const e=useNavigate(),[i,r]=reactExports.useState([]),[n,o]=reactExports.useState([]),[c,u]=reactExports.useState([]),[x,m]=reactExports.useState(""),[f,g]=reactExports.useState(!1),[R,j]=reactExports.useState(""),[P,S]=reactExports.useState(!1),[b,I]=reactExports.useState(!1),[E,k]=reactExports.useState(!1),[y,C]=reactExports.useState(initialForm),[M,B]=reactExports.useState({});async function G(){g(!0);try{const N=await api(`/admin/inventory/items?q=${encodeURIComponent(x.trim())}&limit=800`);r(N||[])}catch{j("Impossibile caricare inventario")}finally{g(!1)}}async function U(){try{const[N,F]=await Promise.all([api("/admin/taxes"),api("/admin/excises")]);o(N||[]),u(F||[])}catch{j("Impossibile caricare IVA/Accise")}}reactExports.useEffect(()=>{G(),U()},[]),reactExports.useEffect(()=>{const N=setTimeout(G,250);return()=>clearTimeout(N)},[x]);const H=reactExports.useMemo(()=>{const N=i.length,F=i.reduce(($,Y)=>$+Number(Y.stockQty||0),0),A=i.reduce(($,Y)=>$+Number(Y.purchasePrice||0)*Number(Y.stockQty||0),0),O=i.reduce(($,Y)=>$+Number(Y.price||0)*Number(Y.stockQty||0),0),q=i.reduce(($,Y)=>{const J=Y.exciseRateRef;if(!J)return $;const pt=J.type==="ML"?Number(J.amount||0)*Number(Y.mlProduct||0):Number(J.amount||0);return $+pt*Number(Y.stockQty||0)},0),D=i.reduce(($,Y)=>{const J=Number(Y.taxRateRef?.rate||0);if(!J)return $;const pt=Y.exciseRateRef,bt=pt?.type==="ML"?Number(pt.amount||0)*Number(Y.mlProduct||0):Number(pt?.amount||0),Ct=Number(Y.price||0)+bt;return $+Ct*Number(Y.stockQty||0)*(J/100)},0);return{totalItems:N,totalStock:F,totalValue:A,subtotal:O,totalExcise:q,totalVat:D}},[i]),ht=reactExports.useMemo(()=>{const N=new Map;for(const F of i){const A=(F.subcategory||"Senza sottocategoria").trim(),O=N.get(A)||{name:A,qty:0};O.qty+=Number(F.stockQty||0),N.set(A,O)}return Array.from(N.values()).sort((F,A)=>A.qty-F.qty||F.name.localeCompare(A.name,"it"))},[i]);function dt(){C(initialForm),S(!0)}function it(N){C({id:N.id,sku:N.sku||"",name:N.name||"",description:N.description||"",shortDescription:N.shortDescription||"",brand:N.brand||"",category:N.category||"",subcategory:N.subcategory||"",barcode:N.barcode||"",nicotine:N.nicotine??"",mlProduct:N.mlProduct??"",stockQty:Number(N.stockQty||0),purchasePrice:N.purchasePrice??"",listPrice:N.listPrice??"",price:N.price??"",taxRateId:N.taxRateId||"",exciseRateId:N.exciseRateId||""}),S(!0)}function Et(){const N={};for(const F of i)N[F.id]=String(Number(F.stockQty||0));B(N),I(!0)}async function vt(){if(!y.sku.trim()||!y.name.trim()){j("SKU e nome sono obbligatori");return}k(!0);const N={sku:y.sku.trim(),name:y.name.trim(),description:y.description||null,shortDescription:y.shortDescription||null,brand:y.brand||null,category:y.category||null,subcategory:y.subcategory||null,barcode:y.barcode||null,nicotine:y.nicotine===""?null:Number(y.nicotine),mlProduct:y.mlProduct===""?null:Number(y.mlProduct),stockQty:Number(y.stockQty||0),purchasePrice:y.purchasePrice===""?null:Number(y.purchasePrice),listPrice:y.listPrice===""?null:Number(y.listPrice),price:y.price===""?null:Number(y.price),taxRateId:y.taxRateId||null,exciseRateId:y.exciseRateId||null};try{y.id?await api(`/admin/inventory/items/${y.id}`,{method:"PATCH",body:JSON.stringify(N)}):await api("/admin/inventory/items",{method:"POST",body:JSON.stringify(N)}),S(!1),await G()}catch{j("Impossibile salvare articolo inventario")}finally{k(!1)}}async function lt(){const N=i.map(F=>({id:F.id,stockQty:Number(M[F.id])})).filter(F=>Number.isFinite(F.stockQty)&&F.stockQty>=0);if(N.length){k(!0);try{await api("/admin/inventory/quick-qty",{method:"PATCH",body:JSON.stringify({changes:N})}),I(!1),await G()}catch{j("Impossibile salvare quantità rapide")}finally{k(!1)}}}return jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{children:"Inventario"}),jsxRuntimeExports.jsx("p",{children:"Magazzino interno separato dall'ecommerce"})]}),jsxRuntimeExports.jsxs("div",{className:"page-actions inventory-actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>e("/admin/goods-receipts"),children:"Arrivo merci"}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:Et,children:"Modifica quantità rapida"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:dt,children:"Nuovo articolo"})]})]}),jsxRuntimeExports.jsx(InlineError,{message:R,onClose:()=>j("")}),jsxRuntimeExports.jsxs("div",{className:"cards inventory-cards",children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"Articoli"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:H.totalItems})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"Giacenza totale"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:H.totalStock})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"Valore a costo"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:money$1(H.totalValue)})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"Imponibile"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:money$1(H.subtotal)})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"Accise stimate"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:money$1(H.totalExcise)})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"card-label",children:"IVA stimata"}),jsxRuntimeExports.jsx("div",{className:"card-value",children:money$1(H.totalVat)})]})]}),jsxRuntimeExports.jsx("div",{className:"filters-row",children:jsxRuntimeExports.jsxs("div",{className:"filter-group",style:{minWidth:280},children:[jsxRuntimeExports.jsx("label",{children:"Cerca"}),jsxRuntimeExports.jsx("input",{value:x,onChange:N=>m(N.target.value),placeholder:"SKU, nome, brand, categoria"})]})}),jsxRuntimeExports.jsxs("div",{className:"table subcategory-stock-table",children:[jsxRuntimeExports.jsxs("div",{className:"row header",children:[jsxRuntimeExports.jsx("div",{children:"Sottocategoria"}),jsxRuntimeExports.jsx("div",{children:"Quantità totale"})]}),ht.length?ht.map(N=>jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{children:N.name}),jsxRuntimeExports.jsx("div",{children:N.qty})]},N.name)):jsxRuntimeExports.jsxs("div",{className:"row",children:[jsxRuntimeExports.jsx("div",{className:"muted",children:"Nessuna sottocategoria"}),jsxRuntimeExports.jsx("div",{children:"0"})]})]}),jsxRuntimeExports.jsxs("div",{className:"inventory-table",children:[jsxRuntimeExports.jsxs("div",{className:"inventory-row header",children:[jsxRuntimeExports.jsx("div",{children:"SKU"}),jsxRuntimeExports.jsx("div",{children:"Nome"}),jsxRuntimeExports.jsx("div",{children:"Brand"}),jsxRuntimeExports.jsx("div",{children:"Categoria"}),jsxRuntimeExports.jsx("div",{children:"Sottocategoria"}),jsxRuntimeExports.jsx("div",{children:"Giacenza"}),jsxRuntimeExports.jsx("div",{children:"Costo"}),jsxRuntimeExports.jsx("div",{children:"Prezzo"}),jsxRuntimeExports.jsx("div",{children:"Accisa"}),jsxRuntimeExports.jsx("div",{children:"IVA"}),jsxRuntimeExports.jsx("div",{})]}),f?jsxRuntimeExports.jsx("div",{className:"inventory-empty",children:"Caricamento..."}):null,!f&&!i.length?jsxRuntimeExports.jsx("div",{className:"inventory-empty",children:"Nessun articolo"}):null,f?null:i.map(N=>jsxRuntimeExports.jsxs("div",{className:"inventory-row",children:[jsxRuntimeExports.jsx("div",{className:"mono",children:N.sku}),jsxRuntimeExports.jsx("div",{children:N.name}),jsxRuntimeExports.jsx("div",{children:N.brand||"-"}),jsxRuntimeExports.jsx("div",{children:N.category||"-"}),jsxRuntimeExports.jsx("div",{children:N.subcategory||"-"}),jsxRuntimeExports.jsx("div",{children:N.stockQty}),jsxRuntimeExports.jsx("div",{children:N.purchasePrice!=null?money$1(N.purchasePrice):"-"}),jsxRuntimeExports.jsx("div",{children:N.price!=null?money$1(N.price):"-"}),jsxRuntimeExports.jsx("div",{children:N.exciseRateRef?.name||"-"}),jsxRuntimeExports.jsx("div",{children:N.taxRateRef?.name||"-"}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{className:"btn ghost small",onClick:()=>it(N),children:"Modifica"})})]},N.id))]}),P?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>S(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal inventory-edit-modal",onClick:N=>N.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:jsxRuntimeExports.jsx("h3",{children:y.id?"Modifica articolo inventario":"Nuovo articolo inventario"})}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>S(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body modal-body-single inventory-modal-body",children:[jsxRuntimeExports.jsxs("div",{className:"inventory-edit-grid",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"SKU"}),jsxRuntimeExports.jsx("input",{value:y.sku,onChange:N=>C(F=>({...F,sku:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Nome"}),jsxRuntimeExports.jsx("input",{value:y.name,onChange:N=>C(F=>({...F,name:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Brand"}),jsxRuntimeExports.jsx("input",{value:y.brand,onChange:N=>C(F=>({...F,brand:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Categoria"}),jsxRuntimeExports.jsx("input",{value:y.category,onChange:N=>C(F=>({...F,category:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Sottocategoria"}),jsxRuntimeExports.jsx("input",{value:y.subcategory,onChange:N=>C(F=>({...F,subcategory:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Barcode"}),jsxRuntimeExports.jsx("input",{value:y.barcode,onChange:N=>C(F=>({...F,barcode:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Nicotina"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:y.nicotine,onChange:N=>C(F=>({...F,nicotine:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"ML"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:y.mlProduct,onChange:N=>C(F=>({...F,mlProduct:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Giacenza"}),jsxRuntimeExports.jsx("input",{type:"number",value:y.stockQty,onChange:N=>C(F=>({...F,stockQty:Number(N.target.value||0)}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Prezzo acquisto"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:y.purchasePrice,onChange:N=>C(F=>({...F,purchasePrice:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Prezzo listino"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:y.listPrice,onChange:N=>C(F=>({...F,listPrice:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Prezzo vendita"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:y.price,onChange:N=>C(F=>({...F,price:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"IVA"}),jsxRuntimeExports.jsxs("select",{value:y.taxRateId,onChange:N=>C(F=>({...F,taxRateId:N.target.value})),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Nessuna"}),n.map(N=>jsxRuntimeExports.jsx("option",{value:N.id,children:N.name},N.id))]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{children:"Accisa"}),jsxRuntimeExports.jsxs("select",{value:y.exciseRateId,onChange:N=>C(F=>({...F,exciseRateId:N.target.value})),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Nessuna"}),c.map(N=>jsxRuntimeExports.jsx("option",{value:N.id,children:N.name},N.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"full",children:[jsxRuntimeExports.jsx("label",{children:"Descrizione breve"}),jsxRuntimeExports.jsx("input",{value:y.shortDescription,onChange:N=>C(F=>({...F,shortDescription:N.target.value}))})]}),jsxRuntimeExports.jsxs("div",{className:"full",children:[jsxRuntimeExports.jsx("label",{children:"Descrizione"}),jsxRuntimeExports.jsx("textarea",{className:"goods-paste",value:y.description,onChange:N=>C(F=>({...F,description:N.target.value}))})]})]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>S(!1),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:vt,disabled:E,children:E?"Salvataggio...":"Salva"})]})]})]})})}):null,b?jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:()=>I(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal inventory-qty-modal",onClick:N=>N.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("div",{className:"modal-title",children:jsxRuntimeExports.jsx("h3",{children:"Modifica quantità rapida"})}),jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>I(!1),children:"Chiudi"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-body modal-body-single inventory-modal-body",children:[jsxRuntimeExports.jsxs("div",{className:"inventory-qty-list",children:[jsxRuntimeExports.jsxs("div",{className:"inventory-qty-row header",children:[jsxRuntimeExports.jsx("div",{children:"SKU"}),jsxRuntimeExports.jsx("div",{children:"Prodotto"}),jsxRuntimeExports.jsx("div",{children:"Qta"})]}),i.map(N=>jsxRuntimeExports.jsxs("div",{className:"inventory-qty-row",children:[jsxRuntimeExports.jsx("div",{className:"mono",children:N.sku}),jsxRuntimeExports.jsx("div",{children:N.name}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("input",{type:"number",min:"0",value:M[N.id]??N.stockQty,onChange:F=>B(A=>({...A,[N.id]:F.target.value}))})})]},N.id))]}),jsxRuntimeExports.jsxs("div",{className:"actions",children:[jsxRuntimeExports.jsx("button",{className:"btn ghost",onClick:()=>I(!1),children:"Annulla"}),jsxRuntimeExports.jsx("button",{className:"btn primary",onClick:lt,disabled:E,children:E?"Salvataggio...":"Salva quantità"})]})]})]})})}):null]})}const newRow=()=>({sku:"",name:"",codicePl:"",qty:1,unitCost:"",unitPrice:"",discount:"",rowTotal:0,description:"",shortDescription:"",brand:"",category:"",subcategory:"",barcode:"",nicotine:"",mlProduct:"",taxRateId:"",exciseRateId:"",lineNote:"",imageUrl:""}),money=e=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(Number(e||0)),CSV_HEADERS=["sku","name","codicePl","qty","unitCost","discount","brand","category","subcategory","barcode","nicotine","mlProduct","taxRate","lineNote"];function splitCsvLine(e){const i=[];let r="",n=!1;for(let o=0;o<e.length;o+=1){const c=e[o];if(c==='"'){n&&e[o+1]==='"'?(r+='"',o+=1):n=!n;continue}if(c===";"&&!n){i.push(r),r="";continue}r+=c}return i.push(r),i.map(o=>o.trim())}function AdminGoodsReceipts(){const e=reactExports.useRef(null),i=reactExports.useRef([]),r=reactExports.useRef({}),n=reactExports.useRef({}),[o,c]=reactExports.useState([newRow()]),[u,x]=reactExports.useState([]),[m,f]=reactExports.useState([]),[g,R]=reactExports.useState(new Set),[j,P]=reactExports.useState(""),[S,b]=reactExports.useState(""),[I,E]=reactExports.useState([]),[k,y]=reactExports.useState(""),[C,M]=reactExports.useState(""),[B,G]=reactExports.useState(""),[U,H]=reactExports.useState(!1),[ht,dt]=reactExports.useState(""),[it,Et]=reactExports.useState(""),[vt,lt]=reactExports.useState([]),[N,F]=reactExports.useState(null),[A,O]=reactExports.useState(null),[q,D]=reactExports.useState(""),[$,Y]=reactExports.useState(""),[J,pt]=reactExports.useState(""),[bt,Ct]=reactExports.useState(""),[Tt,K]=reactExports.useState([]),[Dt,Lt]=reactExports.useState([]),[$t,zt]=reactExports.useState([]),[Rt,ye]=reactExports.useState({});async function he(){try{const tt=await api("/admin/goods-receipts");lt(tt||[])}catch{dt("Impossibile caricare arrivi merci")}}reactExports.useEffect(()=>{he()},[]),reactExports.useEffect(()=>{async function tt(){try{const[rt,z,at,mt]=await Promise.all([api("/admin/taxes"),api("/admin/excises"),api("/admin/inventory/items?limit=1000"),api("/admin/suppliers")]);x(rt||[]),f(z||[]),R(new Set((at||[]).map(Pt=>String(Pt.sku||"").trim()).filter(Boolean))),E(mt||[])}catch{dt("Impossibile caricare IVA/Accise")}}tt()},[]);async function ce(tt){const rt=String(tt||"").trim();if(!rt)return null;if(Rt[rt])return Rt[rt];try{const z=await api(`/admin/goods-receipts/sku-info?sku=${encodeURIComponent(rt)}`);return ye(at=>({...at,[rt]:z})),z}catch{return null}}function Xt(tt,rt){if(!rt?.found)return tt;const z=rt.inventory||{},at=rt.product||{},mt=(...ae)=>{for(const $e of ae)if($e!=null&&$e!=="")return $e;return""},Pt=Array.isArray(at.categoryIds)?at.categoryIds.filter(Boolean):[],St=Array.isArray(at.subcategories)?at.subcategories.filter(Boolean):[],Qt=Pt.join(", "),Ht=St.join(", ");return{...tt,name:mt(z.name,at.name,tt.name),codicePl:mt(at.codicePl,tt.codicePl),description:mt(z.description,at.description,tt.description),shortDescription:mt(z.shortDescription,at.shortDescription,tt.shortDescription),brand:mt(z.brand,at.brand,tt.brand),category:mt(z.category,at.category,Qt,tt.category),subcategory:mt(z.subcategory,at.subcategory,Ht,tt.subcategory),barcode:mt(z.barcode,at.barcode,tt.barcode),nicotine:String(mt(z.nicotine,at.nicotine,tt.nicotine)),mlProduct:String(mt(z.mlProduct,at.mlProduct,tt.mlProduct)),taxRateId:mt(z.taxRateId,at.taxRateId,tt.taxRateId),exciseRateId:mt(z.exciseRateId,at.exciseRateId,tt.exciseRateId),unitCost:rt.last?.unitCost!==null&&rt.last?.unitCost!==void 0?String(rt.last.unitCost):tt.unitCost!==""?tt.unitCost:z.purchasePrice!==void 0&&z.purchasePrice!==null?String(z.purchasePrice):at.purchasePrice!==void 0&&at.purchasePrice!==null?String(at.purchasePrice):at.price!==void 0&&at.price!==null?String(at.price):"",unitPrice:tt.unitPrice!==""?tt.unitPrice:z.price!==void 0&&z.price!==null?String(z.price):at.price!==void 0&&at.price!==null?String(at.price):"",imageUrl:mt(at.imageUrl,Array.isArray(at.imageUrls)&&at.imageUrls.length?at.imageUrls[0]:"",tt.imageUrl)||tt.imageUrl||""}}function pe(tt,rt,z=!1){const at=z?n.current:r.current,mt=String(tt);at[mt]&&clearTimeout(at[mt]);const Pt=String(rt||"").trim();!Pt||Pt.length<2||(at[mt]=setTimeout(async()=>{const St=await ce(Pt);St?.found&&(z?K(Qt=>Qt.map((Ht,ae)=>ae===tt&&String(Ht.sku||"").trim()===Pt?Xt(Ht,St):Ht)):c(Qt=>Qt.map((Ht,ae)=>ae===tt&&String(Ht.sku||"").trim()===Pt?Xt(Ht,St):Ht)))},240))}async function oe(tt){return await Promise.all(tt.map(async z=>{const at=String(z.sku||"").trim();if(!at)return z;const mt=await ce(at);return Xt(z,mt)}))}const se=reactExports.useMemo(()=>o.filter(tt=>tt.sku.trim()&&Number(tt.qty||0)>0),[o]),Kt=reactExports.useMemo(()=>se.reduce((tt,rt)=>{const z=Number(rt.qty||0),at=Number(rt.unitCost||0),mt=z*at,Pt=Number(rt.mlProduct||0),St=u.find(ms=>ms.id===rt.taxRateId),Qt=Number(St?.rate||0),Ht=m.find(ms=>ms.id===rt.exciseRateId),ae=Ht?Ht.type==="ML"?Number(Ht.amount||0)*Pt:Number(Ht.amount||0):0,$e=Qt>0?(at+ae)*(Qt/100):0;return tt.lines+=1,tt.qty+=z,tt.cost+=mt,tt.subtotal+=mt,tt.vat+=z*$e,tt},{lines:0,qty:0,cost:0,subtotal:0,vat:0}),[se,u,m]);function ue(tt,rt){c(z=>z.map((at,mt)=>mt===tt?{...at,...rt}:at)),Object.prototype.hasOwnProperty.call(rt,"sku")&&pe(tt,rt.sku,!1)}async function Zt(tt){const rt=String(o[tt]?.sku||"").trim();if(!rt)return;const z=await ce(rt);z?.found&&c(at=>at.map((mt,Pt)=>Pt===tt?Xt(mt,z):mt))}function Ce(tt){c(rt=>rt.filter((z,at)=>at!==tt))}function ie(tt,rt){if(rt.key!=="Enter")return;if(rt.preventDefault(),tt===o.length-1){c(at=>[...at,newRow()]),setTimeout(()=>{const at=i.current[tt+1];at&&at.focus()},0);return}const z=i.current[tt+1];z&&z.focus()}async function de(){const tt=B.split(/\r?\n/).map(at=>at.trim()).filter(Boolean);if(!tt.length)return;const rt=tt.map(at=>{const mt=at.includes("	")?at.split("	"):at.split(/[;,]/);return{sku:(mt[0]||"").trim(),name:(mt[1]||"").trim(),codicePl:(mt[2]||"").trim(),qty:Number(String(mt[3]||"1").replace(",","."))||1,unitCost:String(mt[4]||"").trim(),discount:String(mt[5]||"").trim(),brand:(mt[6]||"").trim(),category:(mt[7]||"").trim(),subcategory:(mt[8]||"").trim(),barcode:(mt[9]||"").trim(),nicotine:String(mt[10]||"").trim(),mlProduct:String(mt[11]||"").trim(),taxRateId:"",exciseRateId:"",lineNote:"",description:"",shortDescription:"",imageUrl:"",unitPrice:""}}),z=await oe(rt);c(z),G("")}function ke(){const tt=["SKU-001","Prodotto esempio","PL-0001","10","3.50","0","Brand Demo","Categoria Demo","Subcategoria Demo","1234567890123","10","10","22%","Nota riga"],rt=`${CSV_HEADERS.join(";")}
dist/assets/index-CC7q4qTa.css:@import"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fraunces:opsz,wght@9..144,400;9..144,700&display=swap";:root{color-scheme:light;--bg: #f3f6fb;--bg-2: #eef2f8;--ink: #101728;--muted: #5b6472;--brand: #0ea5e9;--brand-2: #34d399;--panel: #ffffff;--panel-2: #f8fafc;--stroke: rgba(16, 23, 40, .08);--shadow-soft: 0 18px 45px rgba(16, 23, 40, .08);--shadow-strong: 0 24px 60px rgba(16, 23, 40, .12)}*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,sans-serif;color:var(--ink);background:radial-gradient(circle at 18% 10%,#ffffff 0,transparent 45%),radial-gradient(circle at 80% 0%,#e8f3ff 0,transparent 40%),linear-gradient(135deg,var(--bg) 0%,var(--bg-2) 100%);min-height:100vh;position:relative}html,body{height:100%}.admin-shell,.admin-main{transform:none!important}body.modal-open{overflow:hidden}body.modal-open .admin-main,body.modal-open .admin-sidebar{-webkit-backdrop-filter:none!important;backdrop-filter:none!important}body:before,body:after{content:"";position:fixed;z-index:-1;border-radius:50%;filter:blur(0px);opacity:.7}body:before{width:520px;height:520px;top:-140px;left:-120px;background:radial-gradient(circle,rgba(14,165,233,.18),transparent 65%)}body:after{width:420px;height:420px;bottom:-120px;right:-80px;background:radial-gradient(circle,rgba(52,211,153,.22),transparent 70%)}a{text-decoration:none;color:inherit}h1,h2,h3{font-family:Fraunces,serif;margin:0 0 .4rem;letter-spacing:.01em}p{margin:0;color:var(--muted)}label{display:grid;gap:.45rem;font-size:.85rem;color:var(--muted)}input,textarea,select{width:100%;padding:.85rem 1rem;border-radius:14px;border:1px solid var(--stroke);background:#ffffffe6;color:var(--ink);font-size:.95rem;outline:none;transition:border-color .2s ease,box-shadow .2s ease,background .2s ease}input:focus,textarea:focus,select:focus{border-color:#0ea5e999;box-shadow:0 0 0 4px #0ea5e91f;background:#fff}textarea{resize:vertical}button{font-family:inherit}.btn{padding:.75rem 1.15rem;border-radius:12px;border:1px solid transparent;background:var(--ink);color:#fff;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease,border-color .2s ease,background .2s ease;font-weight:600}.btn.primary{background:linear-gradient(135deg,var(--brand),#3b82f6);border-color:transparent}.btn.ghost{background:#fffc;color:var(--ink);border-color:var(--stroke)}.btn.danger{background:linear-gradient(135deg,#ef4444,#f97316);border-color:transparent}.btn:disabled{cursor:not-allowed;opacity:.6;transform:none;box-shadow:none}.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 14px 30px #1017282e}.admin-shell{min-height:100vh;display:grid;grid-template-columns:260px 1fr;gap:1.5rem;padding:1.5rem}.admin-sidebar{padding:2rem 1.5rem;background:#ffffffdb;border:1px solid var(--stroke);border-radius:28px;box-shadow:var(--shadow-soft);-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);display:flex;flex-direction:column;gap:2rem;position:sticky;top:1.5rem;height:calc(100vh - 3rem)}.admin-main{padding:1.2rem 1.4rem 1.6rem;background:#ffffffb3;border:1px solid var(--stroke);border-radius:32px;box-shadow:var(--shadow-strong);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);overflow:visible}.admin-main-inner{max-width:100%;margin:0 auto;animation:none}.admin-topbar{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:.5rem 0 1.6rem}.top-title{font-weight:700;font-size:1.1rem}.top-sub{font-size:.85rem;color:var(--muted)}.topbar-actions{display:flex;align-items:center;gap:10px;position:relative}.notif-btn{position:relative;width:44px;height:44px;border-radius:12px;border:1px solid rgba(148,163,184,.35);background:#fff;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}.notif-btn svg{width:22px;height:22px;fill:#334155}.notif-badge{position:absolute;top:-7px;right:-7px;background:#ef4444;color:#fff;border-radius:999px;font-size:11px;line-height:1;padding:4px 6px;border:2px solid #fff;z-index:2}.notif-anim{position:absolute;inset:-10px;pointer-events:none;opacity:.65}.notif-panel{position:absolute;top:calc(100% + 10px);right:54px;width:min(460px,88vw);max-height:70vh;background:#fff;border:1px solid rgba(148,163,184,.25);border-radius:16px;box-shadow:0 20px 40px #0f172a2e;overflow:hidden;z-index:30}.notif-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#f8fafc;border-bottom:1px solid rgba(148,163,184,.2);font-size:13px;color:#64748b}.notif-list{max-height:58vh;overflow-y:auto}.notif-item{width:100%;text-align:left;border-bottom:1px solid rgba(226,232,240,.8);padding:8px 10px 8px 12px;background:#fff;display:grid;grid-template-columns:1fr 30px;gap:8px;align-items:start}.notif-item:hover{background:#f8fafc}.notif-item.is-new{background:#eff6ffe6}.notif-item-title{font-weight:700;color:#0f172a}.notif-item-body{margin-top:2px;color:#334155;font-size:13px}.notif-item-date{margin-top:4px;color:#94a3b8;font-size:12px}.notif-empty{padding:14px;color:#64748b;font-size:13px}.notif-main{border:none;background:transparent;text-align:left;padding:4px 0;cursor:pointer}.notif-dismiss{border:1px solid rgba(148,163,184,.35);border-radius:8px;background:#fff;color:#0f172a;height:28px;width:28px;cursor:pointer;font-weight:700;margin-top:4px}.notif-dismiss:hover{border-color:#0ea5e980;color:#0369a1}.notif-footer{padding:10px 12px;border-top:1px solid rgba(148,163,184,.2);background:#f8fafc}.brand{display:flex;gap:.9rem;align-items:center}.brand-mark{width:54px;height:54px;border-radius:18px;background:#fff;display:grid;place-items:center;box-shadow:0 16px 26px #0f172a2e;border:1px solid rgba(148,163,184,.35)}.brand-logo{width:36px;height:36px;object-fit:contain;filter:drop-shadow(0 6px 12px rgba(14,165,233,.2))}.brand-title{font-weight:700;font-size:1.05rem}.brand-sub{font-size:.85rem;color:var(--muted)}.admin-nav{display:grid;gap:.5rem}.nav-item{position:relative;padding:.8rem 1rem .8rem 1.1rem;border-radius:16px;color:var(--muted);background:transparent;border:1px solid transparent;transition:all .2s ease;display:flex;align-items:center;gap:.6rem;cursor:grab}.nav-item:active{cursor:grabbing}.nav-grip{color:#94a3b8e6;font-weight:700;letter-spacing:-.06em}.nav-item.dragging{opacity:.6;transform:scale(.98)}.nav-item.drag-over{border-color:#0ea5e980;box-shadow:0 10px 22px #0ea5e92e}.nav-item:before{content:"";position:absolute;left:10px;top:50%;transform:translateY(-50%);width:6px;height:6px;border-radius:50%;background:transparent;transition:background .2s ease}.nav-item:hover{background:#0ea5e914;color:var(--ink)}.nav-item.active{background:linear-gradient(120deg,#0ea5e92e,#34d3992e);color:var(--ink);border:1px solid rgba(14,165,233,.25)}.nav-item.active:before{background:var(--brand)}.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.8rem;gap:1rem}.actions{display:flex;gap:.7rem;flex-wrap:wrap}.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}.card{background:linear-gradient(160deg,#fff,#f3f7ff);border-radius:20px;padding:1.4rem;box-shadow:var(--shadow-soft);border:1px solid rgba(14,165,233,.12);animation:rise .6s ease both}.cards .card:nth-child(1){animation-delay:.05s}.cards .card:nth-child(2){animation-delay:.1s}.cards .card:nth-child(3){animation-delay:.15s}.cards .card:nth-child(4){animation-delay:.2s}.card-label{color:var(--muted);font-size:.85rem}.card-value{font-size:1.8rem;font-weight:700;margin-top:.5rem}.card-sub{color:var(--muted);font-size:.85rem}.sparkline{width:100%;height:160px;color:#0f172a;margin:.6rem 0;border:1px solid rgba(148,163,184,.2);border-radius:14px;padding:6px;background:linear-gradient(180deg,#f8fafcb3,#fffffff2)}.panel.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.analytics-toolbar{display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap;align-items:flex-end;margin:1rem 0 1.6rem}.analytics-filters{display:flex;gap:.8rem;flex-wrap:wrap;align-items:flex-end}.analytics-filters label{display:grid;gap:6px;font-size:.85rem;color:var(--muted)}.analytics-filters input[type=date]{border:1px solid var(--stroke);border-radius:12px;padding:.55rem .8rem;background:#fff;color:var(--text)}.analytics-filters input[type=text],.analytics-filters select{border:1px solid var(--stroke);border-radius:12px;padding:.55rem .8rem;background:#fff;color:var(--text);min-width:220px}.analytics-quick,.analytics-export{display:flex;gap:.6rem;flex-wrap:wrap}.analytics-cards{margin-bottom:1.4rem}.analytics-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:1.5rem;margin-top:1.5rem}.analytics-panel{background:#fff;border:1px solid var(--stroke);border-radius:18px;padding:1.25rem;box-shadow:var(--shadow)}.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.chart-stack{display:grid;gap:1rem}.chart-row{display:grid;grid-template-columns:90px 1fr;gap:.8rem;align-items:center}.chart-label{font-size:.85rem;font-weight:600;color:var(--muted)}.chart-label.revenue{color:#0f766e}.chart-label.cost{color:#ea580c}.chart-label.vat{color:#2563eb}.chart-label.excise{color:#9333ea}.analytics-trend{width:100%;height:160px}.chart-gridline{stroke:#94a3b859;stroke-width:.8}.chart-area-fill{fill:currentColor;opacity:.14}.chart-trendline{stroke:#0f172aa6;stroke-dasharray:3 2}.chart-trendline-orders{stroke:#0ea5e9bf}.chart-trendline-revenue{stroke:#22c55ebf}.trend-revenue{color:#0ea5e9}.trend-cost{color:#f97316}.analytics-stacked{width:100%;height:200px;background:linear-gradient(180deg,#f8fafc,#fff);border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:4px}.analytics-stacked .stack-cost{fill:#f97316}.analytics-stacked .stack-vat{fill:#3b82f6}.analytics-stacked .stack-excise{fill:#a855f7}.analytics-stacked .stack-margin{fill:#10b981}.italy-map-wrap{display:grid;grid-template-columns:minmax(340px,1.35fr) minmax(280px,1fr);gap:18px;align-items:start}.italy-map-canvas{position:relative;width:100%}.italy-map{width:100%;min-height:460px;object-fit:contain;border:1px solid rgba(148,163,184,.25);border-radius:16px;padding:14px;background:radial-gradient(circle at 30% 20%,#f0f9ff,#fff 68%)}.italy-map-overlay{position:absolute;inset:14px;width:calc(100% - 28px);height:calc(100% - 28px);overflow:visible;pointer-events:auto}.italy-map-side .table .row{grid-template-columns:1.2fr 90px 120px}.italy-active{margin-top:10px;border:1px solid rgba(14,165,233,.35);background:#e0f2fe73;border-radius:12px;padding:10px 12px;font-size:13px}@media(max-width:980px){.analytics-grid,.chart-row,.italy-map-wrap{grid-template-columns:1fr}}.table.compact .row{grid-template-columns:2fr 1fr 1fr}.panel{background:#fff;border-radius:20px;padding:1.6rem;box-shadow:var(--shadow-soft);border:1px solid var(--stroke)}.products-panel{padding:1.2rem 1.4rem;margin-top:1.2rem}.products-toolbar{display:flex;justify-content:space-between;gap:1.2rem;flex-wrap:wrap;align-items:flex-end;padding:1rem 1.2rem;border:1px solid var(--stroke);border-radius:18px;background:#fffc;box-shadow:var(--shadow-soft)}.toolbar-left{display:flex;gap:.8rem;flex-wrap:wrap}.toolbar-right{display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-end}.toolbar-group{display:grid;gap:6px}.toolbar-group.compact{display:flex;gap:.6rem;align-items:center}.toolbar-label{font-size:.75rem;text-transform:uppercase;letter-spacing:.18em;color:var(--muted)}.brands-panel{margin-top:1.2rem;display:grid;gap:1rem}.brands-toolbar{display:grid;grid-template-columns:minmax(220px,360px) auto minmax(220px,420px);gap:.7rem;align-items:center}@media(max-width:980px){.brands-toolbar{grid-template-columns:1fr}}.rules-layout{display:grid;grid-template-columns:1fr;gap:1.5rem;margin-top:1.2rem}.rules-card,.rules-list{background:#fff;border:1px solid var(--stroke);border-radius:18px;padding:1.25rem;box-shadow:var(--shadow-soft)}.rules-header{display:flex;justify-content:space-between;align-items:center;gap:1rem}.rules-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem}.rules-preview{margin-top:1rem;padding:.9rem 1rem;border-radius:12px;border:1px dashed rgba(148,163,184,.4);background:#f8fafccc}.rules-list-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.rules-form{margin-top:1.2rem;padding-top:1rem;border-top:1px dashed rgba(148,163,184,.4)}.rules-table .row{grid-template-columns:1.6fr .7fr .8fr 1fr .6fr .8fr}.target-picker{display:grid;gap:.6rem}.target-list{border:1px solid var(--stroke);border-radius:14px;padding:.35rem;max-height:220px;overflow:auto;background:#f8fafcb3}.target-row{width:100%;display:grid;grid-template-columns:26px 1fr;gap:.65rem;align-items:center;border:0;background:transparent;padding:.45rem .6rem;border-radius:10px;cursor:pointer;text-align:left;font-size:.9rem}.target-row:hover{background:#3b82f614}.target-row.active{background:#2563eb1f}.target-check{width:20px;height:20px;border-radius:6px;border:1px solid var(--stroke);display:inline-flex;align-items:center;justify-content:center;font-size:.75rem;color:#fff;background:#fff}.target-check.active{background:#2563eb;border-color:#2563eb}.target-meta{font-size:.8rem;color:var(--muted)}.rules-advanced{margin-top:1rem;padding-top:.75rem;border-top:1px dashed rgba(148,163,184,.35)}@media(max-width:820px){.modal{width:min(680px,94vw);padding:1.2rem}.rules-grid,.modal-body.modal-body-single .rules-grid{grid-template-columns:1fr}.target-list{max-height:180px}}.day-picker{display:flex;gap:.5rem;flex-wrap:wrap}.day-pill{border:1px solid var(--stroke);background:#fff;padding:.35rem .75rem;border-radius:999px;font-size:.8rem;cursor:pointer}.day-pill.active{background:#2563eb1f;border-color:#2563eb66;color:#1d4ed8}@media(max-width:1024px){.rules-layout{grid-template-columns:1fr}}.list{margin:.7rem 0 0;padding-left:1rem}.table{display:grid;gap:.7rem;overflow-x:auto;padding-bottom:.4rem}.table::-webkit-scrollbar{height:8px}.table::-webkit-scrollbar-thumb{background:#94a3b866;border-radius:999px}.table::-webkit-scrollbar-track{background:transparent}.table.wide-6 .row,.table.wide-6 .row.header{grid-template-columns:.7fr 1.2fr 2fr 1fr 1fr 1fr}.table.wide-12 .row,.table.wide-12 .row.header{grid-template-columns:.7fr 1fr 2.6fr .9fr .8fr 1fr 1.4fr 1.4fr 1.1fr 1.1fr 1fr 1.4fr;min-width:1380px}.table.wide-11 .row,.table.wide-11 .row.header{grid-template-columns:.7fr 1fr 2.6fr .9fr .8fr 1fr 1.2fr 1.4fr 1.1fr 1fr 1.4fr;min-width:1260px}.table.wide-10 .row,.table.wide-10 .row.header{grid-template-columns:.7fr 1fr 2.7fr .9fr .8fr 1fr 1.2fr 1.6fr 1.2fr 1fr;min-width:1180px}.excise-cell{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.table.wide-report .row,.table.wide-report .row.header{grid-template-columns:.9fr .9fr 1.5fr .9fr 2fr .7fr .9fr .8fr .8fr 1fr;min-width:1420px}.category-table .row,.category-table .row.header{grid-template-columns:2fr 1fr 120px}.categories-rich-table .row,.categories-rich-table .row.header{grid-template-columns:2fr 1fr 2fr .7fr 1.6fr;min-width:980px}.btn.small{padding:.35rem .6rem;font-size:.82rem;border-radius:10px}.toggle{display:flex;align-items:center;gap:8px}.toggle input{width:18px;height:18px}.upload-drop{margin-top:12px;border:1px dashed rgba(120,150,190,.4);border-radius:14px;padding:12px;text-align:center;cursor:pointer;background:#ffffffb3}.upload-drop.loading{opacity:.6;pointer-events:none}.image-grid{margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}.image-item{background:#fff;border:1px solid var(--stroke);border-radius:12px;padding:8px;display:grid;gap:6px;position:relative}.image-item img{width:100%;height:90px;object-fit:cover;border-radius:8px}.image-actions{display:grid;gap:6px}.image-x{position:absolute;top:6px;right:6px;width:26px;height:26px;border-radius:999px;border:none;background:#0f172abf;color:#fff;font-size:16px;line-height:1;cursor:pointer;display:grid;place-items:center}.row{display:grid;grid-template-columns:repeat(5,1fr);gap:1rem;align-items:center;padding:.9rem 1.1rem;border-radius:16px;background:#ffffffe6;border:1px solid rgba(148,163,184,.25);box-shadow:0 10px 24px #0f172a14,inset 0 1px #fff9;transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease}.row>div{min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.row .name-cell{white-space:normal;overflow:visible}.row .name-cell span{white-space:normal}.row.header{background:transparent;border:none;box-shadow:none;font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.16em}.row.clickable{cursor:pointer}.row.clickable:hover{transform:translateY(-2px);border-color:#0ea5e966;box-shadow:0 16px 34px #1017281f}.row.parent-row{border-left:4px solid rgba(59,130,246,.6);background:linear-gradient(135deg,#eff6ffe6,#fffffff2);box-shadow:0 16px 32px #3b82f61f,inset 0 1px #ffffffb3}.row.child-row{margin-left:22px;border-left:2px solid rgba(148,163,184,.45);position:relative;background:#fffffff0}.row.child-row:before{content:"";position:absolute;left:-22px;top:50%;width:18px;height:2px;background:#94a3b873}.row.unavailable{border-color:#ef444459;background:#fee2e299}.row.draft{border-color:#fb923c80;background:linear-gradient(135deg,#ffedd5cc,#fffffff5)}.row .actions{display:flex;gap:.6rem}.cell-muted{color:var(--muted);font-weight:600}.name-cell{display:inline-flex;align-items:center;gap:.5rem;flex-wrap:wrap;line-height:1.25}.name-cell .tag{white-space:nowrap}.tag.warn{background:#ffedd5;color:#c2410c;border:1px solid #fed7aa;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}.thumb-cell{display:inline-flex;align-items:center;gap:.6rem}.collapse-spacer{width:26px;height:26px;display:inline-block}.form-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin-top:1rem}.form-grid .full{grid-column:1 / -1}.thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;border:1px solid var(--stroke);background:#fff}.thumb-wrap{display:flex;align-items:center;gap:.5rem}.pulse-dot{width:22px;height:22px}.thumb.placeholder{background:linear-gradient(135deg,#f1f5f9,#e2e8f0)}.thumb.placeholder.large{width:160px;height:160px}.related-picker{margin-top:8px;border:1px solid var(--stroke);border-radius:12px;background:#fff;max-height:200px;overflow:auto;padding:8px;display:grid;gap:6px}.related-item{display:grid;grid-template-columns:22px 48px minmax(0,1fr);gap:10px;font-size:.92rem;align-items:center;padding:8px 10px;border:1px solid rgba(148,163,184,.2);border-radius:10px;background:linear-gradient(180deg,#f8fafc99,#fff)}.related-check{width:18px;height:18px;margin:0}.related-thumb{width:48px;height:48px;border-radius:10px;object-fit:cover;border:1px solid var(--stroke);background:#fff}.related-thumb.placeholder{background:linear-gradient(135deg,#f1f5f9,#e2e8f0)}.related-text{min-width:0;color:var(--text);line-height:1.25}.related-box{margin-top:6px;border:1px solid rgba(148,163,184,.25);border-radius:14px;padding:10px;background:linear-gradient(180deg,#f0f9ff73,#fffffff2)}.related-toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.related-search{margin-bottom:8px}.related-chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}.related-chip{border:1px solid rgba(14,165,233,.25);background:#0ea5e91a;color:#0c4a6e;border-radius:999px;font-size:.78rem;padding:.2rem .55rem;font-weight:600}.related-chip.more{background:#1e40af1a;border-color:#1e40af38;color:#1e3a8a}.mail-marketing-layout{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(0,1fr))}.mail-form{display:grid;gap:12px}.checkbox-row{display:inline-flex;align-items:center;gap:8px;font-size:.95rem;color:var(--text)}.checkbox-row input[type=checkbox],.checkbox-row input[type=radio]{width:16px;height:16px}.mail-audience-head{display:flex;gap:18px;flex-wrap:wrap}.mail-audience-box{border:1px solid var(--stroke);border-radius:16px;padding:12px;display:grid;gap:10px;background:#f8fbff}.mail-audience-list{border:1px solid var(--stroke);border-radius:12px;max-height:220px;overflow:auto;background:#fff}.mail-audience-item{display:grid;grid-template-columns:18px 1fr;gap:10px;align-items:start;padding:10px 12px;border-bottom:1px solid #edf2f7}.mail-audience-item:last-child{border-bottom:none}.mail-audience-item span{grid-column:2;font-weight:600;line-height:1.3}.mail-audience-item small{grid-column:2;display:block;color:var(--muted);margin-top:2px;word-break:break-all}.status-pill{display:inline-flex;align-items:center;border-radius:999px;padding:3px 10px;border:1px solid var(--stroke);font-size:.78rem;font-weight:700;letter-spacing:.03em}.status-draft{background:#eef2ff;color:#3730a3}.status-scheduled{background:#fff7ed;color:#b45309}.status-sent{background:#e8f8ef;color:#047857}.status-failed{background:#fee2e2;color:#b91c1c}.mail-preview{border:1px solid var(--stroke);border-radius:14px;background:#fff;padding:14px;max-height:60vh;overflow:auto}.mail-template-table .row{grid-template-columns:1.3fr 1.4fr 1fr}.mail-campaign-table .row{grid-template-columns:1.2fr .8fr 1fr 1fr 1.4fr}.mail-history-table .row{grid-template-columns:100px 1.2fr 1.6fr 180px 180px}.companies-table .row{grid-template-columns:1.4fr .9fr 1fr 1.2fr 1fr 1fr 90px 120px 120px 160px;min-width:1560px}@media(max-width:1080px){.mail-marketing-layout,.mail-campaign-table .row,.mail-history-table .row,.mail-template-table .row{grid-template-columns:1fr}}.input-error{border-color:#ef4444cc!important;box-shadow:0 0 0 2px #ef44441f}.field-error{margin-top:4px;font-size:.8rem;color:#dc2626;font-weight:600}.modal-backdrop{position:fixed!important;inset:0;width:100vw;height:100vh;background:#0f172a38;display:flex;align-items:center;justify-content:center;padding:24px 16px;z-index:1000;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);overflow-y:auto}.modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:min(1040px,94vw);background:#fff;border-radius:24px;box-shadow:var(--shadow-strong);padding:1.6rem 2rem;border:1px solid var(--stroke);animation:modal-pop .35s ease both;max-height:90vh;overflow:hidden}.modal-backdrop .modal{margin:0}.modal.product-modal{max-height:92vh;display:flex;flex-direction:column}.modal.product-modal .modal-body{overflow-y:auto;padding-right:.4rem}.modal-header{display:flex;justify-content:space-between;align-items:center;gap:1rem}.modal-title{display:flex;align-items:center;gap:.8rem}.tag.success{background:#e6f8f0;color:#0f766e;border:1px solid #99f6e4;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}.tag.danger{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}.tag.info{background:#e0f2fe;color:#0369a1;border:1px solid #bae6fd;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}.flag.hero{display:inline-flex;align-items:center;gap:.6rem;padding:.55rem .95rem;border-radius:999px;background:linear-gradient(135deg,#e14a2b1f,#f2b35b40);border:1px solid rgba(225,74,43,.4);color:#5a1a10;font-weight:600}.flag-dot{width:12px;height:12px;border-radius:999px;background:linear-gradient(135deg,#e14a2b,#f2b35b);box-shadow:0 0 0 3px #e14a2b26}.modal-body{display:grid;grid-template-columns:200px 1fr;gap:1.5rem;margin-top:1rem}.modal-body.modal-body-single{grid-template-columns:1fr;max-height:78vh;overflow-y:auto;padding-right:.6rem}.modal-body.modal-body-single .rules-grid{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}.modal-body.modal-body-single .rules-grid .full{grid-column:1 / -1}.modal-body.modal-body-single .rules-form{padding-top:0;border-top:none;margin-top:0}.modal-body.modal-body-single .actions{margin-top:1.2rem}.modal.parent-modal .modal-body{grid-template-columns:1fr}.parent-upload .upload-drop{min-height:170px;border-radius:18px}.parent-upload img{width:100%;height:170px;object-fit:cover;border-radius:14px;border:1px solid var(--stroke)}.modal-media{position:relative}.modal-media img{width:100%;border-radius:16px;border:1px solid var(--stroke)}.cover-wrap{position:relative}.cover-clear{position:absolute;top:8px;right:8px;width:30px;height:30px;border-radius:999px;border:none;background:#0f172abf;color:#fff;font-size:18px;line-height:1;cursor:pointer;display:grid;place-items:center}.modal-info{display:grid;gap:.6rem;font-size:.95rem}.child-list{margin-top:.4rem;display:grid;gap:.4rem;max-height:260px;overflow:auto;padding-right:.4rem;align-items:stretch}.child-toolbar{margin-top:.4rem;display:grid;grid-template-columns:1fr 220px auto;gap:.6rem;align-items:center}.child-search input{width:100%}.child-row{display:grid;grid-template-columns:110px 1fr auto;align-items:center;gap:.6rem;border:1px solid var(--stroke);border-radius:12px;padding:.5rem .75rem;background:#fff;cursor:pointer;transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease;text-align:left;width:100%;justify-self:stretch}.child-row .mono{text-align:left}.input-row{display:flex;gap:.6rem;align-items:center}.input-row input{flex:1}@media(max-width:860px){.child-toolbar{grid-template-columns:1fr}}.child-row:hover{transform:translateY(-1px);border-color:#0ea5e959;box-shadow:0 10px 18px #0f172a14}.child-row.active{border-color:#0ea5e999;background:linear-gradient(135deg,#0ea5e914,#3b82f61f)}.delete-chip{position:absolute;top:10px;right:10px;padding:.35rem .7rem;border-radius:999px;border:none;background:#ef4444f2;color:#fff;cursor:pointer}.confirm{margin-top:.8rem;padding:.8rem 1rem;border-radius:12px;background:#fff1f2;border:1px solid #fecdd3;display:grid;gap:.6rem}.confirm-dialog{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:20px;padding:1.2rem 1.4rem;box-shadow:var(--shadow-soft);max-width:420px;width:90vw;border:1px solid var(--stroke);z-index:1002;font-family:Inter,system-ui,sans-serif}.check{display:inline-flex;align-items:center;gap:.5rem}.check.disabled{opacity:.5}.muted{color:var(--muted)}.rich-text{color:var(--muted);line-height:1.55}.rich-text p{margin:0 0 8px}.rich-text strong{color:var(--text)}.rich-text ul,.rich-text ol{margin:0 0 8px 18px}.rte{border:1px solid var(--stroke);border-radius:12px;background:#fff;overflow:hidden}.rte-toolbar{display:flex;flex-wrap:wrap;gap:8px;padding:10px;border-bottom:1px solid var(--stroke);background:#f8fafc}.rte-btn{border:1px solid var(--stroke);border-radius:8px;background:#fff;color:var(--text);font-weight:700;font-size:12px;line-height:1;padding:8px 10px;cursor:pointer}.rte-btn:hover{background:#eff6ff;border-color:#93c5fd}.rte-editor{min-height:170px;padding:12px;line-height:1.55;color:var(--text);outline:none;white-space:pre-wrap}.rte-editor:empty:before{content:attr(data-placeholder);color:var(--muted)}.rte-editor p{margin:0 0 10px}.rte-editor ul,.rte-editor ol{margin:0 0 10px 18px}.rte-editor h1,.rte-editor h2,.rte-editor h3{margin:0 0 10px;line-height:1.25}.rte-editor img{max-width:100%;height:auto;border-radius:8px}.mono{font-family:SF Mono,ui-monospace,monospace}.error{margin:1rem 0;padding:.8rem 1rem;background:#ffe4e6;border:1px solid #fecdd3;border-radius:12px;color:#9f1239;display:flex;align-items:center;justify-content:space-between;gap:12px}.error-close{background:transparent;border:none;color:#9f1239;font-size:18px;cursor:pointer}.auth-wrap{min-height:100vh;display:grid;place-items:center;padding:2rem;position:relative;overflow:hidden}.auth-wrap.auth-epic{background:radial-gradient(circle at 20% 10%,#1c2029,#0b0f14 50%,#06080b)}.auth-filter{position:absolute;width:0;height:0}.auth-scene{position:absolute;inset:0;z-index:0;pointer-events:none}.auth-sky{position:absolute;inset:-10%;background:radial-gradient(circle at 20% 20%,rgba(88,130,255,.18),transparent 45%),radial-gradient(circle at 80% 30%,rgba(71,220,255,.22),transparent 40%),radial-gradient(circle at 50% 80%,rgba(255,120,190,.08),transparent 50%);filter:blur(10px);animation:skyShift 18s ease-in-out infinite}.auth-aurora{position:absolute;inset:-20%;background:conic-gradient(from 180deg at 50% 50%,#00ffdc14,#785aff1f,#ff78c80f,#00ffdc14);filter:blur(40px);opacity:.6;mix-blend-mode:screen;animation:auroraFlow 22s linear infinite}.auth-fog{position:absolute;inset:-30%;filter:blur(30px);opacity:.85}.auth-fog .fog{position:absolute;width:70vmax;height:70vmax;border-radius:50%;background:radial-gradient(circle at 40% 40%,rgba(255,255,255,.25),transparent 60%),radial-gradient(circle at 70% 70%,rgba(160,190,255,.12),transparent 65%);animation:fogDrift 26s ease-in-out infinite}.auth-fog .f1{top:-20vmax;left:-10vmax;animation-duration:30s}.auth-fog .f2{bottom:-25vmax;right:-15vmax;animation-duration:24s;animation-delay:-8s}.auth-fog .f3{top:10vmax;right:20vmax;animation-duration:28s;animation-delay:-14s}.auth-canvas{position:absolute;inset:0;width:100%;height:100%;opacity:.45;mix-blend-mode:screen;filter:blur(.5px)}.auth-noise{position:absolute;inset:0;background-image:repeating-radial-gradient(circle at 30% 20%,rgba(255,255,255,.03) 0 2px,transparent 2px 4px),repeating-radial-gradient(circle at 70% 60%,rgba(255,255,255,.02) 0 1px,transparent 1px 3px);mix-blend-mode:soft-light;opacity:.35;animation:noiseMove 8s steps(2) infinite}.auth-sparks{position:absolute;inset:0}.auth-sparks .spark{position:absolute;width:2px;height:2px;border-radius:50%;background:#c8e6ffe6;box-shadow:0 0 12px #78beffe6;opacity:.7;animation:sparkFloat 10s ease-in-out infinite}.auth-sparks .s1{top:20%;left:15%;animation-delay:-1s}.auth-sparks .s2{top:30%;left:70%;animation-delay:-3s}.auth-sparks .s3{top:60%;left:40%;animation-delay:-5s}.auth-sparks .s4{top:75%;left:80%;animation-delay:-7s}.auth-sparks .s5{top:15%;left:55%;animation-delay:-9s}.auth-sparks .s6{top:45%;left:25%;animation-delay:-2s}.auth-sparks .s7{top:85%;left:20%;animation-delay:-4s}.auth-sparks .s8{top:65%;left:60%;animation-delay:-6s}.auth-sparks .s9{top:35%;left:85%;animation-delay:-8s}.auth-sparks .s10{top:55%;left:10%;animation-delay:-10s}.auth-sparks .s11{top:10%;left:40%;animation-delay:-12s}.auth-sparks .s12{top:80%;left:50%;animation-delay:-14s}.auth-vignette{position:absolute;inset:0;background:radial-gradient(circle at center,transparent 35%,rgba(5,6,10,.9) 80%)}.auth-front-fog{position:absolute;inset:-10%;background:radial-gradient(circle at 20% 70%,rgba(180,210,255,.22),transparent 55%),radial-gradient(circle at 70% 30%,rgba(120,160,220,.18),transparent 60%),radial-gradient(circle at 40% 40%,rgba(255,255,255,.08),transparent 60%);filter:blur(28px) url(#fog-noise);opacity:.95;mix-blend-mode:screen;animation:fogPulse 18s ease-in-out infinite;z-index:2}@keyframes skyShift{0%{transform:translateZ(0) scale(1)}50%{transform:translate3d(-2vmax,1vmax,0) scale(1.02)}to{transform:translate3d(2vmax,-1vmax,0) scale(1)}}@keyframes auroraFlow{0%{transform:rotate(0) scale(1)}to{transform:rotate(360deg) scale(1.04)}}@keyframes fogDrift{0%{transform:translateZ(0) scale(1);opacity:.55}50%{transform:translate3d(4vmax,-2vmax,0) scale(1.08);opacity:.9}to{transform:translate3d(-3vmax,3vmax,0) scale(1);opacity:.6}}@keyframes noiseMove{0%{transform:translateZ(0)}50%{transform:translate3d(-1%,1%,0)}to{transform:translate3d(1%,-1%,0)}}@keyframes sparkFloat{0%{transform:translateZ(0);opacity:.4}50%{transform:translate3d(0,-8px,0);opacity:.9}to{transform:translateZ(0);opacity:.4}}@keyframes fogPulse{0%{transform:translateZ(0) scale(1);opacity:.6}50%{transform:translate3d(1vmax,-1vmax,0) scale(1.06);opacity:.9}to{transform:translate3d(-1vmax,1vmax,0) scale(1);opacity:.65}}.auth-card{width:min(460px,92vw);background:#0a0e14c7;padding:2.6rem;border-radius:26px;box-shadow:var(--shadow-strong);border:1px solid rgba(110,140,190,.25);-webkit-backdrop-filter:blur(18px);backdrop-filter:blur(18px);animation:float-in .6s ease;position:relative;z-index:3}.register-card{width:min(860px,92vw);background:#fff;color:#0f172a;box-shadow:0 40px 90px #0f172a29;border-radius:28px;padding:2.4rem}.register-page .auth-header p{color:#475569}.register-form .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.register-form .form-grid .full{grid-column:1 / -1}.success-banner{margin-top:10px;padding:10px 12px;border-radius:12px;background:#10b9811f;color:#0f766e;font-weight:600}.auth-header{text-align:center;margin-bottom:1.8rem}.auth-logo{width:88px;height:88px;object-fit:contain;margin:.35rem auto .8rem;filter:drop-shadow(0 16px 22px rgba(56,189,248,.45))}.auth-badge{display:inline-block;padding:.3rem .9rem;border-radius:999px;background:#4ade801f;color:#a7f3d0;font-size:.8rem;margin-bottom:.6rem;border:1px solid rgba(74,222,128,.25)}.auth-form{display:grid;gap:1rem}.auth-card h1,.auth-card p,.auth-card label{color:#e2e8f0}.auth-card input{background:#080c12cc;border-color:#7896be4d;color:#e2e8f0}.auth-card input::placeholder{color:#e2e8f099}.register-page{background:radial-gradient(circle at 15% 10%,#fef3c7,transparent 35%),radial-gradient(circle at 85% 20%,#e0f2fe,transparent 40%),linear-gradient(120deg,#f8fafc,#eef2ff 50%,#f1f5f9)}.register-layout{width:min(1200px,95vw);display:grid;grid-template-columns:minmax(260px,1fr) minmax(420px,1.4fr);gap:32px;align-items:stretch}.register-hero{position:relative;border-radius:28px;background:linear-gradient(155deg,#0f172a,#1e293b 55%,#0b1220);color:#e2e8f0;padding:2.6rem 2.2rem;overflow:hidden;box-shadow:0 30px 70px #0f172a59}.register-hero-inner{position:relative;z-index:2;display:grid;gap:18px}.register-logo{width:110px;height:110px;object-fit:contain;filter:drop-shadow(0 20px 25px rgba(56,189,248,.35))}.register-badge{display:inline-flex;align-items:center;gap:8px;padding:.35rem .9rem;border-radius:999px;background:#3b82f629;color:#bfdbfe;border:1px solid rgba(59,130,246,.35);font-weight:600;font-size:.85rem}.register-hero h1{font-size:2rem;line-height:1.2;margin:0;color:#f8fafc}.register-hero p{color:#cbd5f5;line-height:1.6}.register-highlight{display:grid;gap:14px}.register-highlight strong{display:block;font-size:1rem;color:#f8fafc}.register-highlight span{color:#cbd5f5;font-size:.92rem}.register-hero-gradient{position:absolute;inset:0;background:radial-gradient(circle at 20% 20%,rgba(59,130,246,.35),transparent 55%),radial-gradient(circle at 70% 60%,rgba(236,72,153,.2),transparent 55%);opacity:.9;z-index:1}.register-header{display:flex;align-items:flex-start;justify-content:space-between;gap:18px;margin-bottom:1.5rem}.register-header h2{margin:0 0 6px;font-size:1.6rem}.register-header p{margin:0;color:#64748b}.form-section{padding:1.2rem 1.4rem;border-radius:20px;background:#f8fafc;border:1px solid #e2e8f0;display:grid;gap:14px}.form-section+.form-section{margin-top:16px}.section-title{font-weight:700;color:#1e293b;text-transform:uppercase;letter-spacing:.08em;font-size:.75rem}.register-form .form-grid input{background:#fff;border:1px solid #e2e8f0;color:#0f172a}.register-actions{display:flex;align-items:center;gap:16px;margin-top:18px}.register-note{color:#64748b;font-size:.9rem}@media(max-width:980px){.register-layout{grid-template-columns:1fr}.register-hero{padding:2rem}}@media(max-width:640px){.register-card{padding:1.6rem}.register-header,.register-actions{flex-direction:column;align-items:flex-start}}.select{width:100%;padding:.6rem .8rem;border-radius:12px;border:1px solid var(--stroke);background:#fff;color:var(--text)}.select[multiple]{min-height:120px;padding:.55rem}.inline-create{display:grid;gap:8px;align-content:start}.inline-create input{width:100%}.pagination{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;align-items:center}.page-btn{border:1px solid var(--stroke);background:#fff;color:var(--text);padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:600}.page-btn.active{background:#111827;color:#fff;border-color:#111827}.page-btn.ghost{background:transparent}.page-btn:disabled{opacity:.5;cursor:not-allowed}.page-dots{color:var(--muted);font-weight:700;padding:0 4px}.password-field{position:relative;display:grid;align-items:center}.password-field input{padding-right:42px}.password-field.smoke-on:before{content:"";position:absolute;inset:6px 44px 6px 12px;border-radius:10px;background:radial-gradient(circle at 20% 40%,rgba(220,235,255,.75),transparent 60%),radial-gradient(circle at 60% 60%,rgba(140,170,220,.6),transparent 65%),radial-gradient(circle at 80% 35%,rgba(255,255,255,.45),transparent 55%);filter:blur(14px);opacity:1;pointer-events:none;animation:smokeMask 5s ease-in-out infinite}.password-field .eye-btn{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:1px solid rgba(120,150,190,.3);background:#0c1018b3;color:#e2e8f0;border-radius:10px;width:32px;height:28px;cursor:pointer;display:grid;place-items:center}.password-field .eye-btn:hover{background:#1c2638cc}.password-field .eye-icon{width:16px;height:10px;border:1.5px solid rgba(226,232,240,.85);border-radius:10px;position:relative;box-shadow:0 0 6px #78aaff59}.password-field .eye-icon:after{content:"";position:absolute;width:4px;height:4px;border-radius:50%;background:#e2e8f0e6;left:50%;top:50%;transform:translate(-50%,-50%);box-shadow:0 0 6px #78aaff66}.password-field .eye-btn.on .eye-icon{border-color:#78dcffe6}.password-field .eye-btn.on .eye-icon:before{content:"";position:absolute;left:-2px;right:-2px;top:50%;height:1.5px;background:#e2e8f0cc;transform:translateY(-50%) rotate(-18deg)}.smoke-pass{-webkit-text-security:disc;color:#e2e8f0d9;text-shadow:0 0 6px rgba(180,210,255,.45),0 0 14px rgba(120,160,220,.35);filter:blur(.6px)}@keyframes smokeMask{0%{transform:translateZ(0) scale(1);opacity:.85}50%{transform:translate3d(6px,-2px,0) scale(1.04);opacity:1}to{transform:translate3d(-4px,3px,0) scale(1);opacity:.85}}.success-center{position:fixed;inset:0;width:100vw;height:100vh;display:block;background:#0f172a33;z-index:1001;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.success-card{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:1px solid var(--stroke);border-radius:20px;display:flex;align-items:center;gap:1rem;padding:1rem 1.3rem;box-shadow:var(--shadow-strong);animation:modal-pop .35s ease both}.loading-center{position:fixed;inset:0;width:100vw;height:100vh;display:block;background:#0f172a33;z-index:1001;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.loading-card{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:1px solid var(--stroke);border-radius:22px;display:flex;align-items:center;gap:1rem;padding:1.2rem 1.6rem;box-shadow:var(--shadow-strong);min-width:260px;max-width:360px;animation:modal-pop .35s ease both}.loading-card>div:first-child{width:90px;height:90px}.loading-close{position:absolute;top:10px;right:12px;width:28px;height:28px;border-radius:999px;border:none;background:#0f172abf;color:#fff;font-size:16px;line-height:1;cursor:pointer;display:grid;place-items:center}.loading-dock{position:fixed;right:18px;bottom:18px;background:#fff;border:1px solid var(--stroke);border-radius:16px;display:flex;align-items:center;gap:.8rem;padding:.6rem .9rem;box-shadow:var(--shadow-strong);z-index:1001;animation:slide-in .35s ease both}.loading-dock>div:first-child{width:44px;height:44px}@keyframes slide-in{0%{transform:translate3d(40px,40px,0);opacity:0}to{transform:translateZ(0);opacity:1}}.login-success{position:fixed;inset:0;z-index:5;display:grid;place-items:center;background:#070a108c;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.login-success-card{width:min(340px,80vw);background:#080c12e6;border:1px solid rgba(120,170,255,.3);border-radius:20px;padding:22px 18px;display:grid;gap:12px;align-items:center;justify-items:center;box-shadow:0 30px 60px #080a1080}.login-success-card .login-success-text{color:#e2e8f0;font-weight:600;letter-spacing:.02em}.success-card>div:first-child{width:80px;height:80px}@keyframes float-in{0%{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}@keyframes rise{0%{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}@keyframes modal-pop{0%{opacity:0;transform:translate(-50%,-50%) scale(.98)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}@media(max-width:980px){.admin-shell{grid-template-columns:1fr}.admin-sidebar{position:relative;height:auto;flex-direction:row;align-items:center;gap:1rem;overflow-x:auto}.admin-nav{display:flex;gap:.6rem;flex-wrap:wrap}.admin-main{padding:1.6rem 1.2rem 2.2rem}.page-header{flex-direction:column;align-items:flex-start}.row,.table.wide-6 .row{grid-template-columns:1fr 2fr 1fr}.row.header{display:none}.modal-body{grid-template-columns:1fr}.modal.product-modal{width:min(720px,94vw)}.modal.product-modal .modal-body{padding-right:0}.panel.grid-2{grid-template-columns:1fr}}@media(max-width:640px){.admin-shell{padding:1rem}.admin-sidebar{padding:1.4rem 1.1rem}.admin-topbar{flex-direction:column;align-items:flex-start}.cards{grid-template-columns:1fr}.image-grid{grid-template-columns:repeat(2,1fr)}.modal.product-modal{width:94vw;padding:1.2rem 1.1rem}.modal.product-modal .modal-body{gap:1rem}}.modal-backdrop{z-index:1000}.success-center{z-index:1001}.modal{display:block;width:min(1320px,96vw);max-height:calc(100vh - 32px);overflow:auto}.bulk-modal{width:min(1200px,96vw);max-height:92vh;display:flex;flex-direction:column}.bulk-subtitle{margin-top:.4rem}.bulk-table{margin-top:1rem;border:1px solid var(--stroke);border-radius:16px;overflow:auto;max-height:60vh}.bulk-row{display:grid;grid-template-columns:100px minmax(220px,1.3fr) repeat(6,110px) 110px 200px 150px 150px 100px 100px 90px 180px;gap:.6rem;align-items:center;padding:.6rem .8rem;border-bottom:1px solid var(--stroke);background:#fff}.bulk-row.header{position:sticky;top:0;z-index:1;background:#f8fafc;font-size:.75rem;text-transform:uppercase;letter-spacing:.08em;font-weight:600;color:var(--muted)}.bulk-row input,.bulk-row select{width:100%;padding:.4rem .55rem;border-radius:10px;border:1px solid var(--stroke);background:#fff;font-size:.85rem}.bulk-row .mono{font-size:.85rem;display:inline-flex;align-items:center;gap:.4rem}.switch{position:relative;width:44px;height:24px;display:inline-flex;align-items:center}.switch input{opacity:0;width:0;height:0}.switch span{position:absolute;inset:0;background:#e2e8f0;border-radius:999px;transition:background .2s ease}.switch span:after{content:"";position:absolute;top:3px;left:4px;width:18px;height:18px;border-radius:999px;background:#fff;box-shadow:0 2px 6px #0f172a2e;transition:transform .2s ease}.switch input:checked+span{background:#38bdf8}.switch input:checked+span:after{transform:translate(18px)}.switch.danger input:checked+span{background:#ef4444}@media(max-width:980px){.bulk-modal{width:94vw}.bulk-row{grid-template-columns:120px 1fr;grid-auto-rows:auto}}.collapse-toggle{width:26px;height:26px;border-radius:10px;border:1px solid rgba(148,163,184,.6);background:#fff;color:#0f172a;display:inline-flex;align-items:center;justify-content:center;font-weight:800;cursor:pointer;box-shadow:0 4px 8px #0f172a14}.collapse-toggle:hover{border-color:#3b82f699;color:#1d4ed8}.bulk-row.child-row{margin-left:18px;border-left:2px solid rgba(148,163,184,.35);position:relative}.bulk-row.child-row:before{content:"";position:absolute;left:-18px;top:50%;width:14px;height:2px;background:#94a3b859}.bulk-row.parent-row{background:#f8fafc;border-left:4px solid rgba(59,130,246,.45)}.bulk-row.drag-over{outline:2px dashed rgba(59,130,246,.6);background:#eff6ffe6}.bulk-row.draft-row{border-left-color:#fb923c99;background:#fff7ede6}.orders-table{background:#fff;border-radius:20px;border:1px solid rgba(148,163,184,.25);overflow:auto;box-shadow:0 18px 40px #0f172a0f}.orders-table .row{display:grid;grid-template-columns:42px 90px 1.1fr 180px 150px 130px 130px 170px 220px;gap:12px;padding:14px 18px;align-items:center;border-bottom:1px solid rgba(226,232,240,.8);min-width:1380px}.orders-table .row.header{background:#f8fafc;text-transform:uppercase;letter-spacing:.12em;font-size:11px;color:#64748b;font-weight:700}.orders-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px;margin:12px 0}.orders-stat-card{display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(148,163,184,.35);border-radius:12px;padding:10px 12px;background:#fff}.orders-stat-card strong{font-size:1.05rem}.orders-bulk-row{display:flex;gap:10px;align-items:center;margin-bottom:10px}.orders-bulk-row select{min-width:220px}.order-kebab{min-width:36px;padding:6px 10px;font-size:20px;line-height:1}.status{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;letter-spacing:.02em}.status.pending{background:#fb923c24;color:#c2410c}.status.processing{background:#22c55e24;color:#15803d}.status.completed{background:#3b82f624;color:#1d4ed8}.status.failed{background:#ef444424;color:#b91c1c}.status.draft{background:#64748b24;color:#475569}.orders-table .row:last-child{border-bottom:none}.status-select{border-radius:12px;border:1px solid rgba(148,163,184,.35);padding:6px 10px;background:#fff;font-weight:600}.order-modal{width:min(1120px,94vw);position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;max-height:calc(100vh - 48px);display:flex;flex-direction:column;margin:0!important;z-index:1001}.order-modal .modal-body{overflow-y:auto;display:block;grid-template-columns:1fr}.order-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-bottom:18px}.order-cta{background:linear-gradient(135deg,#2563eb,#0ea5e9);border:none;padding:10px 18px;border-radius:14px;box-shadow:0 16px 30px #2563eb40}.order-cta:hover{transform:translateY(-1px);box-shadow:0 20px 34px #2563eb4d}.field-hint{font-size:12px;color:#94a3b8;margin-bottom:6px}.order-search-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.order-search-grid{margin-top:10px;display:grid;grid-template-columns:1fr;gap:10px;align-items:start}.order-search-input{position:relative}.order-search{margin-bottom:18px}.order-search input{width:100%}.order-results{display:grid;gap:10px;max-height:320px;overflow:auto;padding-right:6px}.result-item{background:#f8fafc;border:1px solid rgba(148,163,184,.3);border-radius:14px;padding:10px 12px;text-align:left;display:flex;flex-direction:column;gap:4px;cursor:pointer}.result-item:hover{border-color:#3b82f680;box-shadow:0 10px 20px #0f172a14}.result-meta{display:flex;justify-content:space-between;color:#64748b;font-size:12px;gap:8px}.result-title,.line-title{white-space:normal;word-break:break-word}.order-lines{border:1px solid rgba(148,163,184,.25);border-radius:16px;overflow:hidden}.order-lines-header,.order-line{display:grid;grid-template-columns:minmax(260px,2.6fr) 120px 90px 120px 120px;gap:12px;align-items:center;padding:12px 14px}.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}.summary-grid strong{display:block;font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;color:#64748b}.summary-stack{display:grid;gap:10px}.order-lines-header{background:#f8fafc;text-transform:uppercase;font-size:11px;letter-spacing:.12em;color:#64748b;font-weight:700}.order-line{border-top:1px solid rgba(226,232,240,.7)}.order-line input{width:100%}.line-title{font-weight:600;font-size:.95rem;line-height:1.2;white-space:normal;word-break:break-word}.line-meta{font-size:12px;color:#94a3b8}.order-summary{display:flex;justify-content:space-between;align-items:center;margin-top:16px;padding:14px 16px;border-radius:14px;background:#0f172a;color:#fff}.order-modal .actions{margin-top:18px;display:flex;justify-content:flex-end;gap:12px}.shopify-modal{background:#f8fafc;border:1px solid rgba(148,163,184,.2)}.order-layout{display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:start}.order-left,.order-right{display:flex;flex-direction:column;gap:16px;min-width:0}.order-card{background:#fff;border-radius:18px;border:1px solid rgba(148,163,184,.25);padding:16px;box-shadow:0 16px 30px #0f172a0f;min-width:0}.card-title{font-weight:700;font-size:14px;text-transform:uppercase;letter-spacing:.12em;color:#64748b;margin-bottom:12px}.order-summary-card{background:linear-gradient(135deg,#0f172a,#1e293b);color:#f8fafc}.order-summary-card .card-title{color:#e2e8f0cc}.summary-row{display:flex;justify-content:space-between;align-items:center;font-size:18px;margin-bottom:16px}.summary-actions{display:flex;gap:12px;flex-wrap:wrap}.summary-actions .ghost{background:#0f172a59;color:#e2e8f0;border-color:#ffffff40}.summary-actions .primary{background:#3b82f6;color:#fff;border:none}.order-line>div:first-child{min-width:220px}.order-line .btn.ghost{padding:6px 12px}.order-modal .ghost,.order-modal .primary{border-radius:12px;padding:8px 14px;font-weight:600}.order-modal .ghost{background:#fff;border:1px solid rgba(148,163,184,.35)}.order-modal .primary{background:#2563eb;border:none;color:#fff;box-shadow:0 10px 18px #2563eb40}@media(max-width:1100px){.order-layout{grid-template-columns:1fr}}@media(max-width:900px){.modal{width:min(900px,96vw);padding:1.2rem 1.4rem}.order-modal{width:min(900px,96vw);max-height:calc(100vh - 32px)}.order-modal .modal-body{overflow-y:auto}.orders-table .row,.orders-table .row.header{grid-template-columns:42px 90px 1.1fr 180px 150px 130px 130px 170px 220px;min-width:1380px}.order-lines-header,.order-line{grid-template-columns:1fr 1fr}.order-results{max-height:220px}.suppliers-table .row.header{display:none}.suppliers-table .row{display:grid;grid-template-columns:1fr;gap:10px;align-items:start;padding:14px;border-radius:14px;border:1px solid rgba(148,163,184,.25);margin-bottom:10px;background:#fff}}.customer-price-panel{margin-top:10px;border:1px solid rgba(148,163,184,.28);border-radius:16px;padding:14px;background:#f8fafc}.customer-price-header{display:flex;flex-direction:column;gap:4px;margin-bottom:10px}.customer-price-form{display:grid;grid-template-columns:1.4fr .8fr auto;gap:10px;align-items:center;margin-bottom:10px}.customer-price-table .row{grid-template-columns:1.4fr .6fr .5fr}@media(max-width:900px){.customer-price-form{grid-template-columns:1fr}}@media(max-width:640px){.modal{padding:1rem 1.1rem;border-radius:18px}.modal-header{align-items:flex-start;flex-direction:column}.order-lines-header{display:none}.order-line{grid-template-columns:1fr;gap:8px}}.inventory-actions{display:flex;gap:10px}.inventory-cards .card-value{font-size:1.5rem}.inventory-table{margin-top:14px;background:#fff;border-radius:16px;border:1px solid rgba(148,163,184,.22);overflow:hidden}.inventory-row{display:grid;grid-template-columns:110px 1.5fr .9fr .9fr .9fr 90px 120px 120px 120px 120px 100px;gap:10px;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(226,232,240,.8)}.inventory-row.header{text-transform:uppercase;letter-spacing:.1em;font-size:11px;color:#64748b;font-weight:700;background:#f8fafc}.inventory-row:last-child{border-bottom:none}.inventory-empty{padding:18px;color:#64748b}.inventory-modal{width:min(980px,94vw)}.inventory-edit-modal{width:min(1100px,96vw);max-height:calc(100vh - 48px)}.inventory-edit-grid{display:grid;grid-template-columns:repeat(2,minmax(240px,1fr));gap:12px}.inventory-edit-grid .full{grid-column:1 / -1}.inventory-edit-grid label{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:#64748b;margin-bottom:6px}.inventory-qty-modal{width:min(900px,94vw);max-height:calc(100vh - 48px)}.inventory-qty-list{border:1px solid rgba(148,163,184,.22);border-radius:14px;overflow:hidden;max-height:56vh;overflow-y:auto}.inventory-qty-row{display:grid;grid-template-columns:120px 1fr 120px;gap:12px;align-items:center;padding:10px 12px;border-bottom:1px solid rgba(226,232,240,.8)}.inventory-qty-row.header{background:#f8fafc;text-transform:uppercase;letter-spacing:.1em;font-size:11px;color:#64748b;font-weight:700}.inventory-modal-body .actions{margin-top:14px;justify-content:flex-end}.returns-table .row{grid-template-columns:170px 150px 1.2fr 1.1fr 130px 100px}.returns-detail-modal{width:min(1120px,96vw);max-height:calc(100vh - 48px)}.returns-modal-body{max-height:72vh;overflow-y:auto;padding-right:6px}.returns-summary-grid{margin-bottom:14px}.returns-problem-box{border:1px solid rgba(148,163,184,.25);border-radius:14px;padding:12px 14px;background:#f8fafc}.returns-problem-box p{margin:8px 0 0;color:#334155}.returns-images-wrap{margin-top:14px}.returns-images-grid{margin-top:8px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}.returns-image-card{display:grid;gap:8px;border:1px solid rgba(148,163,184,.25);border-radius:12px;padding:8px;color:inherit;text-decoration:none;background:#fff}.returns-image-card img{width:100%;aspect-ratio:1 / 1;object-fit:cover;border-radius:8px;background:#f1f5f9}.returns-image-card span{font-size:12px;color:#64748b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.success-banner{margin:10px 0 12px;background:#10b9811f;border:1px solid rgba(16,185,129,.35);color:#065f46;border-radius:12px;padding:10px 12px;font-weight:600}.error-banner{margin:10px 0 12px;background:#ef44441f;border:1px solid rgba(239,68,68,.35);color:#991b1b;border-radius:12px;padding:10px 12px;font-weight:600}.goods-layout{display:grid;grid-template-columns:minmax(0,1fr) 330px;gap:16px;align-items:start}.goods-main{display:grid;gap:14px}.goods-paste{width:100%;min-height:110px;resize:vertical;border-radius:12px;border:1px solid rgba(148,163,184,.35);padding:10px 12px;font:inherit}.goods-toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:10px}.goods-grid{border:1px solid rgba(148,163,184,.22);border-radius:14px;overflow:hidden;overflow-x:auto}.goods-row{display:grid;grid-template-columns:120px minmax(220px,1.8fr) 120px 80px 120px 90px 140px 130px 190px 100px;gap:8px;padding:8px;align-items:center;border-bottom:1px solid rgba(226,232,240,.8);min-width:1310px}.goods-row.header{background:#f8fafc;text-transform:uppercase;letter-spacing:.1em;font-size:11px;color:#64748b;font-weight:700}.goods-row:last-child{border-bottom:none}.goods-side{display:grid;gap:14px}.goods-receipts-list{display:grid;gap:10px}.goods-receipt-item{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:10px 12px}.goods-receipt-right{display:flex;align-items:center;gap:10px}@media(max-width:1200px){.goods-layout{grid-template-columns:1fr}}@media(max-width:980px){.inventory-row{grid-template-columns:110px 1fr}.goods-row.header{display:none}.inventory-edit-grid{grid-template-columns:1fr}.inventory-qty-row{grid-template-columns:90px 1fr}.returns-table .row{grid-template-columns:130px 120px 1fr}}

> postinstall
> prisma generate

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

✔ Generated Prisma Client (v5.22.0) to ./node_modules/@prisma/client in 333ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Help us improve the Prisma ORM for everyone. Share your feedback in a short 2-min survey: https://pris.ly/orm/survey/release-5-22


up to date, audited 199 packages in 2s

36 packages are looking for funding
  run `npm fund` for details

3 vulnerabilities (1 moderate, 2 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

> build
> tsc

root@ubuntu:/var/www/4vape/backend# 